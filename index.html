<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEO Roadmap - The Fully Bookers</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{--blue:#0066CC;--blue-dark:#004C99;--blue-light:#E6F2FF;--green:#10B981;--green-bg:#D1FAE5;--orange:#F59E0B;--orange-bg:#FEF3C7;--yellow:#EAB308;--yellow-bg:#FEF9C3;--red:#DC2626;--red-bg:#FEE2E2;--lightblue:#3B82F6;--lightblue-bg:#DBEAFE;--gray:#6B7280;--gray-bg:#F3F4F6;--text:#111827;--text-light:#6B7280;--border:#E5E7EB;--bg:#FAFAFA;--white:#FFFFFF;--shadow-sm:0 1px 2px 0 rgb(0 0 0/.05);--shadow:0 4px 6px -1px rgb(0 0 0/.1);--shadow-lg:0 10px 15px -3px rgb(0 0 0/.1)}
body.dark-mode{--text:#FFFFFF;--text-light:#B4B9C5;--border:#3d4354;--bg:#1a1d29;--white:#252938;--gray-bg:#2f3342;--shadow-sm:0 1px 2px 0 rgb(0 0 0/.5);--shadow:0 4px 6px -1px rgb(0 0 0/.5);--shadow-lg:0 10px 15px -3px rgb(0 0 0/.5);--blue-light:#2d3e5f;--green-bg:#1e4d3c;--orange-bg:#4d3617;--yellow-bg:#4d4017;--red-bg:#4d2020;--lightblue-bg:#2d4a7c;--blue:#3b82f6;--green:#34d399;--orange:#fbbf24;--yellow:#fde047;--red:#f87171}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;transition:background-color 0.3s,color 0.3s}
.app{min-height:100vh;position:relative}
.sidebar{width:280px;background:var(--white);border-right:1px solid var(--border);padding:24px 0;position:fixed;top:0;left:0;height:100vh;overflow-y:auto;z-index:100}
.logo{padding:0 24px 24px;border-bottom:1px solid var(--border);margin-bottom:24px}
.logo-text{font-family:'DM Sans',sans-serif;font-size:13px;font-weight:700;color:var(--blue);letter-spacing:.5px;margin-bottom:4px}
.logo-subtitle{font-size:24px;font-weight:700;color:var(--text);font-family:'DM Sans',sans-serif}
.sync-status{padding:0 24px 16px;font-size:12px;display:flex;align-items:center;gap:8px;border-bottom:1px solid var(--border);margin-bottom:16px}
.sync-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.sync-connected{background:var(--green)}
.sync-connecting{background:var(--orange);animation:pulse 1.5s infinite}
.sync-error{background:var(--red)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.sync-text{flex:1;font-size:11px;color:var(--text-light)}
.reload-btn{padding:4px 8px;font-size:10px;background:var(--blue);color:white;border:none;border-radius:4px;cursor:pointer}
.reload-btn:hover{background:var(--blue-dark)}
.mode-indicator{padding:0 24px 8px;font-size:11px;display:flex;align-items:center;gap:6px}
.mode-badge{padding:4px 8px;border-radius:4px;font-weight:600;font-size:10px}
.mode-badge.viewer{background:var(--blue-light);color:var(--blue)}
.mode-badge.admin{background:var(--green-bg);color:var(--green)}
.dark-toggle{margin-left:auto;padding:4px 8px;background:var(--gray-bg);border:1px solid var(--border);borderRadius:6px;cursor:pointer;fontSize:16px;transition:all 0.2s}
.dark-toggle:hover{background:var(--border)}
.save-status{padding:0 24px 8px;font-size:11px;color:var(--text-light);display:flex;align-items:center;gap:6px}
.save-status-dot{width:6px;height:6px;border-radius:50%;background:var(--gray)}
.save-status-dot.saving{background:var(--orange);animation:pulse 1s infinite}
.save-status-dot.success{background:var(--green)}
.save-status-dot.error{background:var(--red)}
.nav-item{padding:10px 24px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:12px;border-left:3px solid transparent}
.nav-item:hover{background:var(--blue-light)}
.nav-item.active{background:var(--blue-light);border-left-color:var(--blue)}
.nav-icon{font-size:18px}
.nav-text{flex:1;font-size:14px;font-weight:500}
.nav-count{font-size:12px;color:var(--text-light);background:var(--gray-bg);padding:2px 8px;border-radius:12px}
.main{flex:1;padding:48px 64px;max-width:1400px;margin-left:280px}
.header{margin-bottom:32px}
.title{font-size:36px;font-weight:700;color:var(--text);margin-bottom:8px;font-family:'DM Sans',sans-serif}
.subtitle{font-size:16px;color:var(--text-light)}
.status-overview{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:32px}
.status-card{background:var(--white);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center;transition:all .2s;cursor:pointer}
.status-card:hover{box-shadow:var(--shadow);transform:translateY(-2px)}
.status-card.active{border-width:2px;box-shadow:var(--shadow)}
.status-icon{font-size:32px;margin-bottom:8px}
.status-count{font-size:28px;font-weight:700;font-family:'DM Sans',sans-serif;margin-bottom:4px}
.status-label{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.status-card.opstartfase .status-count{color:var(--lightblue)}
.status-card.kritiek .status-count{color:var(--red)}
.status-card.aandacht .status-count{color:var(--orange)}
.status-card.schema .status-count{color:var(--yellow)}
.status-card.top .status-count{color:var(--green)}
.filter-bar{background:var(--white);border:1px solid var(--border);border-radius:8px;padding:12px 16px;margin-bottom:24px;display:flex;align-items:center;gap:12px}
.filter-label{font-size:13px;font-weight:600;color:var(--text-light)}
.filter-btn{padding:6px 12px;border:1px solid var(--border);background:var(--white);border-radius:6px;font-size:13px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px}
.filter-btn:hover{background:var(--bg)}
.filter-btn.active{background:var(--blue);color:white;border-color:var(--blue)}
.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px;margin-bottom:48px}
.client-card{background:var(--white);border:1px solid var(--border);border-radius:12px;padding:24px;transition:all .2s;position:relative;cursor:pointer}
.client-card:hover{box-shadow:var(--shadow-lg);transform:translateY(-2px)}
.edit-client-btn{position:absolute;top:12px;left:12px;background:var(--blue);color:white;border:none;border-radius:6px;padding:6px 10px;font-size:14px;cursor:pointer;opacity:0;transition:all .2s;z-index:10}
.client-card:hover .edit-client-btn{opacity:1}
.edit-client-btn:hover{background:var(--blue-dark);transform:scale(1.05)}
.client-status-badge{position:absolute;top:12px;right:12px;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:var(--shadow)}
.client-status-badge.opstartfase{background:var(--lightblue-bg)}
.client-status-badge.kritiek{background:var(--red-bg)}
.client-status-badge.aandacht{background:var(--orange-bg)}
.client-status-badge.schema{background:var(--yellow-bg)}
.client-status-badge.top{background:var(--green-bg)}
.client-header{margin-bottom:12px}
.client-name{font-size:18px;font-weight:700;color:var(--text);font-family:'DM Sans',sans-serif}
.client-meta{font-size:13px;color:var(--text-light);margin-bottom:12px}
.client-link{color:var(--blue);text-decoration:none;display:inline-flex;align-items:center;gap:4px;font-size:12px;margin-right:12px}
.client-link:hover{text-decoration:underline}
.delete-btn{background:var(--red-bg);color:var(--red);border:none;width:32px;height:32px;border-radius:6px;cursor:pointer;font-size:16px;transition:all .2s;display:flex;align-items:center;justify-content:center}
.delete-btn:hover{background:var(--red);color:var(--white)}
.client-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px}
.stat-box{text-align:center}
.stat-number{font-size:24px;font-weight:700;color:var(--blue);font-family:'DM Sans',sans-serif}
.stat-label{font-size:11px;text-transform:uppercase;letter-spacing:.5px;color:var(--text-light);margin-top:4px}
.progress-section{margin-top:16px}
.progress-label{display:flex;justify-content:space-between;font-size:12px;color:var(--text-light);margin-bottom:8px}
.progress-percentage{font-weight:600;color:var(--blue)}
.progress-bar{height:8px;background:var(--gray-bg);border-radius:4px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--blue),var(--blue-dark));transition:width .3s ease;border-radius:4px}
.planning-box{margin-top:16px;padding:12px;background:var(--blue-light);border-radius:6px}
.planning-title{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--blue);margin-bottom:8px}
.planning-item{font-size:12px;color:var(--text);margin-bottom:3px;line-height:1.4}
.pm-overview{display:flex;align-items:center;gap:12px;margin-bottom:24px;flex-wrap:wrap}
.pm-label{font-size:13px;font-weight:700;color:var(--text);text-transform:uppercase;letter-spacing:.5px}
.pm-filter-btn{padding:8px 16px;border:1px solid var(--border);background:var(--white);border-radius:20px;font-size:13px;cursor:pointer;transition:all .2s;display:flex;align-items:center;font-weight:500}
.pm-filter-btn:hover{background:var(--bg);transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.05)}
.pm-filter-btn.active{border-width:2px;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.pm-badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;color:white;margin-top:6px}
.sort-section{display:flex;align-items:center;gap:12px;margin-bottom:24px;flex-wrap:wrap}
.sort-label{font-size:13px;font-weight:700;color:var(--text);text-transform:uppercase;letter-spacing:.5px}
.sort-dropdown{padding:10px 16px;border:1px solid var(--border);border-radius:8px;background:var(--white);font-size:14px;font-weight:500;color:var(--text);cursor:pointer;transition:all .2s;outline:none;min-width:240px}
.sort-dropdown:hover{border-color:var(--blue);background:var(--bg)}
.sort-dropdown:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(74,144,226,.1)}
.add-client-card{background:var(--blue-light);border:2px dashed var(--blue);border-radius:12px;padding:48px 24px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}
.add-client-card:hover{background:var(--blue);border-color:var(--blue-dark)}
.add-client-card:hover .add-icon,.add-client-card:hover .add-text{color:var(--white)}
.add-icon{font-size:48px;color:var(--blue);margin-bottom:12px;transition:all .2s}
.add-text{font-size:16px;font-weight:600;color:var(--blue);transition:all .2s}
.section{margin-bottom:32px}
.section-header{font-size:14px;font-weight:600;color:var(--text);margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:2px solid var(--blue-light)}
.add-item-btn{background:var(--blue);color:var(--white);border:none;padding:6px 12px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.add-item-btn:hover{background:var(--blue-dark)}
.current-client-banner{background:var(--blue-light);padding:16px 20px;border-radius:8px;margin-bottom:32px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.banner-left{display:flex;align-items:center;gap:16px;flex:1}
.banner-text{font-size:14px;color:var(--blue-dark)}
.banner-client{font-weight:700;color:var(--blue)}
.banner-status-display{display:flex;align-items:center;gap:8px;padding:8px 16px;background:white;border-radius:6px;font-size:13px;font-weight:600}
.banner-status-icon{font-size:20px}
.banner-buttons{display:flex;gap:8px}
.banner-btn{background:var(--blue);color:var(--white);border:none;padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.banner-btn:hover{background:var(--blue-dark)}
.banner-btn.danger{background:var(--red)}
.banner-btn.danger:hover{background:#B91C1C}
.task-card{background:var(--white);border:1px solid var(--border);border-radius:8px;padding:16px 20px;margin-bottom:8px;display:flex;align-items:center;gap:16px;transition:all .2s}
.task-card.clickable{cursor:pointer}
.task-card.clickable:hover{box-shadow:var(--shadow);transform:translateY(-1px)}
.task-card.completed{background:var(--bg);opacity:.7}
.checkbox{width:20px;height:20px;border:2px solid var(--border);border-radius:6px;transition:all .2s;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.checkbox.clickable{cursor:pointer}
.checkbox.clickable:hover{border-color:var(--blue)}
.checkbox.checked{background:var(--blue);border-color:var(--blue)}
.checkbox.checked::after{content:'‚úì';color:white;font-size:14px;font-weight:bold}
.task-content{flex:1}
.task-title{font-size:15px;font-weight:500;color:var(--text);margin-bottom:4px}
.task-desc{font-size:13px;color:var(--text-light)}
.task-card.completed .task-title{text-decoration:line-through;color:var(--text-light)}
.delete-item-btn{background:none;border:none;color:var(--text-light);cursor:pointer;transition:all .2s;padding:4px 8px;font-size:16px}
.delete-item-btn:hover{color:var(--red)}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal{background:var(--white);border-radius:12px;padding:32px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}
.modal-title{font-size:24px;font-weight:700;margin-bottom:24px;font-family:'DM Sans',sans-serif}
.input-group{margin-bottom:20px}
.input-label{display:block;font-size:13px;font-weight:600;color:var(--text);margin-bottom:8px}
.modal-input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:6px;font-size:14px;font-family:inherit;transition:all .2s}
.modal-input:focus{outline:none;border-color:var(--blue);box-shadow:0 0 0 3px var(--blue-light)}
.status-select{display:grid;gap:8px;margin-top:8px}
.status-option{padding:12px 16px;border:2px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:12px;background:var(--white)}
.status-option:hover{border-color:var(--blue);background:var(--blue-light)}
.status-option.selected{border-color:var(--blue);background:var(--blue-light);font-weight:600}
.status-option-icon{font-size:24px}
.status-option-text{flex:1;font-size:14px}
.modal-buttons{display:flex;gap:12px;margin-top:24px}
.btn{padding:12px 24px;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit}
.btn-primary{background:var(--blue);color:var(--white)}
.btn-primary:hover{background:var(--blue-dark)}
.btn-secondary{background:var(--gray-bg);color:var(--text)}
.btn-secondary:hover{background:var(--gray)}
.btn-danger{background:var(--red);color:var(--white)}
.btn-danger:hover{background:#B91C1C}
.loading-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;background:var(--bg)}
.spinner{width:48px;height:48px;border:4px solid var(--border);border-top-color:var(--blue);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{margin-top:16px;color:var(--text-light);font-size:14px}
.admin-login-btn{position:fixed;bottom:24px;right:24px;background:var(--blue);color:white;border:none;padding:12px 20px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;box-shadow:var(--shadow-lg);transition:all .2s;display:flex;align-items:center;gap:8px;z-index:999}
.admin-login-btn:hover{background:var(--blue-dark);transform:translateY(-2px)}
.toast{position:fixed;bottom:24px;right:24px;background:var(--white);border:1px solid var(--border);border-radius:8px;padding:16px 20px;box-shadow:var(--shadow-lg);display:flex;align-items:center;gap:12px;z-index:2000;animation:slideIn .3s ease}
.toast.hiding{animation:slideOut .3s ease;opacity:0}
@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(400px);opacity:0}}
.toast-success{border-left:4px solid var(--green)}
.toast-error{border-left:4px solid var(--red)}
.toast-info{border-left:4px solid var(--blue)}
.toast-icon{font-size:20px}
.toast-text{font-size:14px;color:var(--text)}
.empty-state{text-align:center;padding:80px 20px;color:var(--text-light)}
.empty-icon{font-size:64px;margin-bottom:16px;opacity:.5}
.empty-text{font-size:18px;font-weight:600;margin-bottom:8px}
.viewer-overlay{position:absolute;inset:0;background:rgba(255,255,255,.7);display:flex;align-items:center;justify-content:center;border-radius:8px;opacity:0;transition:opacity .2s}
.viewer-mode .add-client-card:hover .viewer-overlay{opacity:1}
.viewer-message{background:var(--white);padding:16px 24px;border-radius:8px;box-shadow:var(--shadow);font-size:13px;color:var(--text);font-weight:600}
.joke-footer{margin-top:48px;padding:12px 0;text-align:center;border-top:1px solid var(--border)}
.joke-text{font-size:11px;color:var(--text-light);font-style:italic;line-height:1.4}
.export-btn{margin:16px 24px 0;padding:10px 16px;background:var(--green);color:white;border:none;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:8px;justify-content:center}
.export-btn:hover{background:#059669;transform:translateY(-1px);box-shadow:var(--shadow)}
</style>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;

// HARDCODED CREDENTIALS
const VIEWER_FIREBASE_CONFIG={
apiKey:"AIzaSyD5o1oXmigR7KWaHkZPPVNRHiXxhqxTOJA",
projectId:"seo-roadmap",
authDomain:"seo-roadmap.firebaseapp.com"
};

// ADMIN WACHTWOORD
const ADMIN_PASSWORD="D0rsrq!W%2CAtqq*";

// SEO JOKES
const SEO_JOKES=[
"Why did the SEO expert cross the road? To get to the top of the SERPs on the other side! üö∂‚Äç‚ôÇÔ∏è",
"SEO is easy. It's just like riding a bike. Except the bike is on fire, and you're on fire, everything is on fire. üî•",
"My SEO is so good, I rank for keywords I didn't even optimize for! üìà",
"Why do SEO experts love the gym? They're always working on their core web vitals! üí™",
"I tried to rank for 'world's best SEO' but Google said 'citation needed'. üòÖ",
"What's an SEO specialist's favorite drink? Link juice! üçπ",
"Why don't black hat SEOs go to heaven? Too many 301 redirects! üòà",
"My keywords are like my jokes - nobody searches for them. ü§∑‚Äç‚ôÇÔ∏è",
"What's an SEO's favorite music genre? Alt-text rock! üé∏",
"Why was the SEO expert always calm? Because they had great organic reach! üßò‚Äç‚ôÇÔ∏è",
"How do SEO experts party? They throw a canonical party - no duplicates allowed! üéâ",
"Why did the SEO break up with JavaScript? Too many rendering issues! üíî",
"What do you call an SEO expert's dog? A search engine retriever! üêï",
"Why do SEOs love coffee? It helps with their morning crawl! ‚òï",
"What's an SEO's favorite sport? Link building! üèóÔ∏è",
"Why was the website cold? It had too many broken links! ü•∂",
"How does Google keep fit? With PageRank exercises! üèÉ‚Äç‚ôÇÔ∏è",
"What did the H1 say to the H2? You're not my type! üòÇ",
"Why do SEOs hate the beach? Too much duplicate content in the sand! üèñÔ∏è",
"What's an SEO's favorite movie? The Link King! ü¶Å",
"Why did the SEO go to therapy? To work on their meta issues! üõãÔ∏è",
"How do you comfort a sad SEO? Give them a backlink hug! ü§ó",
"What's an SEO's favorite game? Hide and seek - with Google! üîç",
"Why do SEOs make terrible comedians? Their jokes never rank! üé§",
"What do you call a lazy SEO? A no-follow specialist! üò¥",
"Why was the SEO expert always hungry? They kept eating up keywords! üçï",
"What's an SEO's favorite dance? The Google shuffle! üíÉ",
"Why don't SEOs like the dark? They can't see the light mode! üåô",
"How do SEOs celebrate success? With a search party! üéä",
"What's an SEO's favorite vegetable? Organic carrots! ü•ï",
"Why did the SEO fail at poker? Too transparent - no hidden text! üÉè",
"What do you call an SEO in winter? A cold crawler! ‚ùÑÔ∏è",
"Why are SEOs bad at relationships? They're always looking for better ranking! üíî",
"What's an SEO's favorite TV show? Game of Rankings! üì∫",
"Why do SEOs love birthdays? More backlinks every year! üéÇ",
"How do SEOs stay cool? With plenty of cache! üßä",
"What's an SEO's worst nightmare? A Google penalty! üò±",
"Why did the SEO go to the doctor? Bad case of crawl errors! üè•",
"What do you call an honest SEO? White hat and proud! üé©",
"Why are SEOs good at parties? They know how to engage users! ü•≥"
];

// STATUS OPTIONS
const STATUS_OPTIONS=[
{key:'opstartfase',label:'Opstartfase',icon:'üîµ',color:'lightblue'},
{key:'kritiek',label:'Kritiek',icon:'üî¥',color:'red'},
{key:'aandacht',label:'Aandacht Vereist',icon:'üü†',color:'orange'},
{key:'schema',label:'Op Schema',icon:'üü°',color:'yellow'},
{key:'top',label:'Loopt als een ‚òÄÔ∏è',icon:'üü¢',color:'green'}
];

// PROJECT MANAGERS
const PROJECT_MANAGERS=[
{key:'hugo',label:'Hugo',icon:'üë®',color:'#4A90E2'},
{key:'michelle',label:'Michelle',icon:'üë©',color:'#E24A90'},
{key:'none',label:'Geen PM',icon:'‚ö™',color:'#CCCCCC'}
];

// ORIGINELE STAPPEN MET SUBKOPJES
const STEPS=[
{id:1,name:'SEO Plan',icon:'üìã',sections:[
{title:'Zoekwoorden onderzoek',tasks:[{id:'1-1',title:'Website',desc:''},{id:'1-2',title:'Concurrentie',desc:''},{id:'1-3',title:'Search Console',desc:''},{id:'1-4',title:'SE Ranking',desc:''}]},
{title:'Zoekwoorden voorstel',tasks:[{id:'1-5',title:'Gestuurd',desc:''},{id:'1-6',title:'Feedback ontvangen',desc:''},{id:'1-7',title:'Verwerkt',desc:''},{id:'1-8',title:'Voltooid',desc:''}]}
]},
{id:2,name:'GMB',icon:'üìç',sections:[{title:'Google My Business',tasks:[{id:'2-1',title:'GMB koppelen',desc:''},{id:'2-2',title:'GMB Locaties',desc:'Alle locaties toegevoegd'},{id:'2-3',title:'GMB Automations Reviews',desc:'Ingesteld'},{id:'2-4',title:'GMB Questionaire',desc:'Ingevuld door klant'}]}]},
{id:3,name:'Technische Optimalisatie',icon:'üîß',sections:[
{title:'Snelheid',tasks:[{id:'4-1',title:'PageSpeed test',desc:'Streef 80+'},{id:'4-2',title:'Afbeeldingen',desc:'Comprimeer'}]},
{title:'Mobile',tasks:[{id:'4-3',title:'Mobile test',desc:'Check mobile'}]},
{title:'Techniek',tasks:[{id:'4-4',title:'SSL-certificaat',desc:'HTTPS'},{id:'4-5',title:'301 redirects',desc:'Oude urls'},{id:'4-6',title:'404 oplossen',desc:'Check GSC'},{id:'4-7',title:'Broken links',desc:'Screaming Frog'},{id:'4-8',title:'Structured data',desc:'Schema.org'}]},
{title:'On-Page',tasks:[{id:'4-9',title:'Title tags',desc:'50-60 tekens'},{id:'4-10',title:'Meta descriptions',desc:'150-160 tekens'},{id:'4-11',title:'Headers',desc:'1 H1, H2s'},{id:'4-12',title:'URL-structuur',desc:'Kort + keyword'},{id:'4-13',title:'Alt-tekst',desc:'5-15 woorden'},{id:'4-14',title:'Interne links',desc:'Relevante paginas'}]}
]},
{id:4,name:'Content Creatie',icon:'‚úçÔ∏è',type:'custom',customFields:[{key:'keyword',label:'Zoekwoord',type:'text'},{key:'url',label:'URL',type:'text'},{key:'words',label:'Hoeveelheid woorden',type:'number'},{key:'deadline',label:'Deadline',type:'select',options:['December 2025','Januari 2026','Februari 2026','Maart 2026','April 2026','Mei 2026','Juni 2026','Juli 2026','Augustus 2026','September 2026','Oktober 2026','November 2026','December 2026']}]},
{id:5,name:'Linkbuilding',icon:'üîó',sections:[{title:'Audit',tasks:[{id:'6-1',title:'Backlink profiel',desc:'Ahrefs'},{id:'6-2',title:'Concurrent links',desc:'Analyseer'},{id:'6-3',title:'Broken links',desc:'Controleer'}]}],type:'hybrid',customSection:{title:'Geplaatste Links',fields:[{key:'url',label:'URL',type:'text'},{key:'anchor',label:'Anchor tekst',type:'text'},{key:'date',label:'Datum',type:'date'}]}},
{id:6,name:'Meten & Bijsturen',icon:'üìä',sections:[{title:'Maandelijks',tasks:[{id:'7-1',title:'Foutmeldingen',desc:''},{id:'7-2',title:'SE Ranking',desc:''},{id:'7-3',title:'Maandrapport',desc:''},{id:'7-reset',title:'üîÑ Reset Maandelijks',desc:'Reset alle maandelijkse taken'}]}]},
{id:7,name:'Planning',icon:'üìÖ',type:'planning',months:[
{key:'2025-12',label:'December 2025'},{key:'2026-01',label:'Januari 2026'},{key:'2026-02',label:'Februari 2026'},
{key:'2026-03',label:'Maart 2026'},{key:'2026-04',label:'April 2026'},{key:'2026-05',label:'Mei 2026'},
{key:'2026-06',label:'Juni 2026'},{key:'2026-07',label:'Juli 2026'},{key:'2026-08',label:'Augustus 2026'},
{key:'2026-09',label:'September 2026'},{key:'2026-10',label:'Oktober 2026'},{key:'2026-11',label:'November 2026'},{key:'2026-12',label:'December 2026'}
]}
];

// LOCAL STORAGE
const saveLocalData=(tasks,customItems,planningItems,notes,deadlines,clients,timeTracking)=>{
localStorage.setItem('seo-tasks',JSON.stringify(tasks));
localStorage.setItem('seo-custom-items',JSON.stringify(customItems));
localStorage.setItem('seo-planning',JSON.stringify(planningItems));
localStorage.setItem('seo-notes',JSON.stringify(notes));
localStorage.setItem('seo-deadlines',JSON.stringify(deadlines));
localStorage.setItem('seo-clients',JSON.stringify(clients));
localStorage.setItem('seo-time-tracking',JSON.stringify(timeTracking||{}));
};

// TOAST
function Toast({message,type,onClose}){
useEffect(()=>{
const timer=setTimeout(()=>{
const el=document.querySelector('.toast');
if(el){el.classList.add('hiding');setTimeout(onClose,300);}
},3000);
return()=>clearTimeout(timer);
},[onClose]);
const icons={success:'‚úÖ',error:'‚ùå',info:'üíæ'};
return(<div className={`toast toast-${type}`}><div className="toast-icon">{icons[type]}</div><div className="toast-text">{message}</div></div>);
}

// ADMIN LOGIN MODAL
function AdminLoginModal({onLogin,onCancel}){
const [password,setPassword]=useState('');
const [error,setError]=useState('');
const handleSubmit=()=>{
if(password===ADMIN_PASSWORD){
onLogin();
}else{
setError('Incorrect wachtwoord');
setTimeout(()=>setError(''),3000);
}
};
return(
<div className="modal-overlay" onClick={onCancel}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">üîê Admin Login</h2>
<p style={{marginBottom:'24px',color:'var(--text-light)',fontSize:'14px'}}>Voer het admin wachtwoord in om edit rechten te krijgen.</p>
{error&&<div style={{background:'var(--red-bg)',color:'var(--red)',padding:'12px',borderRadius:'6px',marginBottom:'16px',fontSize:'13px'}}>{error}</div>}
<div className="input-group">
<label className="input-label">Wachtwoord</label>
<input type="password" className="modal-input" value={password} onChange={(e)=>setPassword(e.target.value)} onKeyPress={(e)=>{if(e.key==='Enter')handleSubmit();}} autoFocus placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
</div>
<div className="modal-buttons">
<button className="btn btn-primary" onClick={handleSubmit}>Inloggen</button>
<button className="btn btn-secondary" onClick={onCancel}>Annuleren</button>
</div>
</div>
</div>
);
}

// PLANNING MONTH
function PlanningMonth({month,selectedClient,planningItems,onAdd,onToggle,onDelete,getCurrentMonth,isAdmin,deadlines,onSetDeadline,onShowDeadlineModal}){
const [showInput,setShowInput]=useState(false);
const [inputValue,setInputValue]=useState('');
const monthItems=planningItems[`${selectedClient}-${month.key}`]||[];
return(
<div className="section">
<div className="section-header">
{month.label}
{month.key===getCurrentMonth()&&(<span style={{marginLeft:'8px',fontSize:'11px',background:'var(--blue)',color:'white',padding:'2px 8px',borderRadius:'12px'}}>Deze maand</span>)}
</div>
{monthItems.map(item=>{
const itemKey=`${selectedClient}-planning-${month.key}-${item.id}`;
const itemDeadline=deadlines[itemKey];
const getUrgency=(dateStr)=>{
if(!dateStr)return{color:'gray',label:'',urgent:false};
const deadline=new Date(dateStr);
const now=new Date();
now.setHours(0,0,0,0);
deadline.setHours(0,0,0,0);
const diffDays=Math.ceil((deadline-now)/(1000*60*60*24));
if(diffDays<0)return{color:'red',label:'Verlopen',urgent:true};
if(diffDays===0)return{color:'red',label:'Vandaag',urgent:true};
if(diffDays===1)return{color:'red',label:'Morgen',urgent:true};
if(diffDays<=7)return{color:'orange',label:`Over ${diffDays} dgn`,urgent:false};
return{color:'green',label:`Over ${diffDays} dgn`,urgent:false};
};
const urgency=getUrgency(itemDeadline);
return(
<div key={item.id} className={`task-card ${item.completed?'completed':''} ${isAdmin?'clickable':''}`} style={{position:'relative'}}>
<div onClick={()=>{if(isAdmin)onToggle(month.key,item.id);}} style={{display:'flex',alignItems:'center',gap:'16px',flex:1}}>
<div className={`checkbox ${item.completed?'checked':''} ${isAdmin?'clickable':''}`}/>
<div className="task-content" style={{flex:1}}>
<div className="task-title">{item.text}</div>
{itemDeadline&&(
<div style={{fontSize:'12px',marginTop:'4px',color:urgency.color==='red'?'#d73a49':urgency.color==='orange'?'#f59e0b':'#10b981',fontWeight:'500'}}>
üìÖ {new Date(itemDeadline).toLocaleDateString('nl-NL',{day:'numeric',month:'short'})} ({urgency.label})
</div>
)}
</div>
</div>
<div style={{display:'flex',gap:'4px'}}>
{isAdmin&&(
<button onClick={(e)=>{e.stopPropagation();onShowDeadlineModal(itemKey,item.text,itemDeadline);}} style={{background:itemDeadline?'#6366f1':'#e5e7eb',color:itemDeadline?'white':'#6b7280',border:'none',borderRadius:'6px',padding:'6px 12px',fontSize:'12px',fontWeight:'600',cursor:'pointer'}} onMouseEnter={(e)=>e.target.style.background=itemDeadline?'#4f46e5':'#d1d5db'} onMouseLeave={(e)=>e.target.style.background=itemDeadline?'#6366f1':'#e5e7eb'}>
{itemDeadline?'‚è∞':'‚è∞'}
</button>
)}
{isAdmin&&<button className="delete-item-btn" onClick={(e)=>{e.stopPropagation();onDelete(month.key,item.id);}}>üóëÔ∏è</button>}
</div>
</div>
);
})}
{isAdmin&&showInput&&(
<div style={{marginTop:'8px',display:'flex',gap:'8px'}}>
<input type="text" className="modal-input" placeholder="Planning item..." value={inputValue}
onChange={(e)=>setInputValue(e.target.value)}
onKeyPress={(e)=>{if(e.key==='Enter'){onAdd(month.key,inputValue);setInputValue('');setShowInput(false);}}}
autoFocus style={{margin:0}}/>
<button className="btn btn-primary" onClick={()=>{onAdd(month.key,inputValue);setInputValue('');setShowInput(false);}} style={{padding:'10px 20px'}}>Toevoegen</button>
<button className="btn btn-secondary" onClick={()=>{setShowInput(false);setInputValue('');}} style={{padding:'10px 20px'}}>Annuleren</button>
</div>
)}
{isAdmin&&!showInput&&(
<button className="add-item-btn" onClick={()=>setShowInput(true)} style={{width:'100%',marginTop:'8px'}}>+ Planning item toevoegen</button>
)}
{monthItems.length===0&&!showInput&&(<div style={{textAlign:'center',padding:'32px',color:'var(--text-light)',fontSize:'14px'}}>Nog geen planning</div>)}
</div>
);
}

// MAIN APP
function App(){
const [loading,setLoading]=useState(true);
const [db,setDb]=useState(null);
const [syncStatus,setSyncStatus]=useState('connecting');
const [activeView,setActiveView]=useState('dashboard');
const [showArchive,setShowArchive]=useState(false);
const [activeStep,setActiveStep]=useState('overview');
const [selectedClient,setSelectedClient]=useState(null);
const [tasks,setTasks]=useState({});
const [customItems,setCustomItems]=useState({});
const [planningItems,setPlanningItems]=useState({});
const [notes,setNotes]=useState({});
const [deadlines,setDeadlines]=useState({});
const [clients,setClients]=useState([]);
const [timeTracking,setTimeTracking]=useState({});
const [showModal,setShowModal]=useState(false);
const [showEditModal,setShowEditModal]=useState(false);
const [showDeleteModal,setShowDeleteModal]=useState(false);
const [showItemModal,setShowItemModal]=useState(false);
const [showStatusModal,setShowStatusModal]=useState(false);
const [showNoteModal,setShowNoteModal]=useState(false);
const [showDeadlineModal,setShowDeadlineModal]=useState(false);
const [deadlineModalTask,setDeadlineModalTask]=useState(null);
const [showTimeModal,setShowTimeModal]=useState(false);
const [timeModalClient,setTimeModalClient]=useState(null);
const [timeModalHours,setTimeModalHours]=useState('');
const [showAdminLogin,setShowAdminLogin]=useState(false);
const [isAdmin,setIsAdmin]=useState(false);
const [darkMode,setDarkMode]=useState(localStorage.getItem('darkMode')==='true');
const [newClient,setNewClient]=useState({name:'',website:'',seRanking:'',city:'',status:'schema',projectManager:'none',budget:0});
const [editingClient,setEditingClient]=useState(null);
const [statusFilter,setStatusFilter]=useState('all');
const [pmFilter,setPmFilter]=useState('all');
const [sortOrder,setSortOrder]=useState('name-asc');
const [expandedPlanning,setExpandedPlanning]=useState({});
const [clientToDelete,setClientToDelete]=useState(null);
const [itemModalData,setItemModalData]=useState({});
const [itemModalStep,setItemModalStep]=useState(null);
const [saveStatus,setSaveStatus]=useState('idle');
const [toast,setToast]=useState(null);

// INIT
useEffect(()=>{
console.log('üöÄ APP STARTING (Viewer Mode)');
initFirebase(VIEWER_FIREBASE_CONFIG);
},[]);

// DARK MODE
useEffect(()=>{
if(darkMode){
document.body.classList.add('dark-mode');
}else{
document.body.classList.remove('dark-mode');
}
localStorage.setItem('darkMode',darkMode);
},[darkMode]);

const toggleDarkMode=()=>{
setDarkMode(!darkMode);
};

// CLIENT VIEWER LINK HANDLING
useEffect(()=>{
const params=new URLSearchParams(window.location.search);
const clientParam=params.get('client');
console.log('üîç URL param check - clientParam:',clientParam,'clients loaded:',clients.length);
if(clientParam&&clients.length>0){
// Convert both to string for comparison since URL params are strings
const client=clients.find(c=>String(c.id)===String(clientParam));
console.log('üîç Found client:',client);
if(client){
console.log('‚úÖ Opening client roadmap:',client.name);
setSelectedClient(client.id);
setActiveView('roadmap');
setActiveStep('overview');
}else{
console.log('‚ùå Client not found for ID:',clientParam);
}
}
},[clients]);

// Reset to overview when client changes
useEffect(()=>{
if(selectedClient){
setActiveStep('overview');
}
},[selectedClient]);

const copyClientLink=(clientId)=>{
console.log('üîó Copy link clicked for client:',clientId);
if(!clientId||clientId==='undefined'){
console.error('‚ùå Invalid client ID:',clientId);
setToast({type:'error',message:'‚ùå Ongeldige client ID'});
return;
}
const url=`${window.location.origin}${window.location.pathname}?client=${clientId}`;
console.log('üìã URL to copy:',url);
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(url).then(()=>{
console.log('‚úÖ Link copied successfully');
setToast({type:'success',message:'‚úì Link gekopieerd!'});
setTimeout(()=>setToast(null),5000);
}).catch((err)=>{
console.error('‚ùå Clipboard error:',err);
const textarea=document.createElement('textarea');
textarea.value=url;
document.body.appendChild(textarea);
textarea.select();
try{
document.execCommand('copy');
setToast({type:'success',message:'‚úì Link gekopieerd!'});
}catch(e){
setToast({type:'error',message:'Kopieer handmatig: '+url});
}
document.body.removeChild(textarea);
});
}else{
console.log('‚ö†Ô∏è Clipboard API not available, using fallback');
const textarea=document.createElement('textarea');
textarea.value=url;
document.body.appendChild(textarea);
textarea.select();
try{
document.execCommand('copy');
setToast({type:'success',message:'‚úì Link gekopieerd!'});
}catch(e){
alert('Kopieer deze link: '+url);
}
document.body.removeChild(textarea);
}
};

// FIREBASE INIT
const initFirebase=async(config)=>{
try{
console.log('üî• FIREBASE INIT');
setSyncStatus('connecting');

if(!firebase.apps.length){
firebase.initializeApp(config);
}

const firestore=firebase.firestore();

try{
await firestore.disableNetwork();
await firestore.enableNetwork();
}catch(e){}

const testDoc=await firestore.collection('roadmaps').doc('main').get();

setDb(firestore);
setSyncStatus('connected');

if(testDoc.exists){
const data=testDoc.data();
// Ensure all clients have IDs
const clientsWithIds=(data.clients||[]).map(c=>c.id?c:{...c,id:Date.now()+Math.random()});
setTasks(data.tasks||{});
setCustomItems(data.customItems||{});
setPlanningItems(data.planningItems||{});
setNotes(data.notes||{});
setDeadlines(data.deadlines||{});
setClients(clientsWithIds);
setTimeTracking(data.timeTracking||{});
saveLocalData(data.tasks||{},data.customItems||{},data.planningItems||{},data.notes||{},data.deadlines||{},clientsWithIds);
}

firestore.collection('roadmaps').doc('main').onSnapshot((doc)=>{
if(doc.exists){
const data=doc.data();
// Ensure all clients have IDs
const clientsWithIds=(data.clients||[]).map(c=>c.id?c:{...c,id:Date.now()+Math.random()});
setTasks(data.tasks||{});
setCustomItems(data.customItems||{});
setPlanningItems(data.planningItems||{});
setNotes(data.notes||{});
setDeadlines(data.deadlines||{});
setClients(clientsWithIds);
setTimeTracking(data.timeTracking||{});
saveLocalData(data.tasks||{},data.customItems||{},data.planningItems||{},data.notes||{},data.deadlines||{},clientsWithIds);
}
});

setLoading(false);
console.log('‚úÖ READY');
}catch(error){
console.error('‚ùå ERROR:',error);
setSyncStatus('error');
setLoading(false);
setToast({type:'error',message:'Verbinding mislukt'});
}
};

// SAVE (admin only)
const saveData=async(updates)=>{
if(!isAdmin)return;
if(!db){setToast({type:'error',message:'Geen verbinding'});return;}
setSaveStatus('saving');
try{
await db.collection('roadmaps').doc('main').set({...updates,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:true});
saveLocalData(updates.tasks||tasks,updates.customItems||customItems,updates.planningItems||planningItems,updates.notes||notes,updates.deadlines||deadlines,updates.clients||clients,updates.timeTracking||timeTracking);
setSaveStatus('success');
setTimeout(()=>setSaveStatus('idle'),2000);
}catch(error){
setToast({type:'error',message:'Opslaan mislukt'});
setSaveStatus('error');
setTimeout(()=>setSaveStatus('idle'),3000);
}
};

// RELOAD
const reloadFromFirebase=async()=>{
if(!db)return;
setToast({type:'info',message:'üîÑ Herladen...'});
try{
const doc=await db.collection('roadmaps').doc('main').get();
if(doc.exists){
const data=doc.data();
setTasks(data.tasks||{});
setCustomItems(data.customItems||{});
setPlanningItems(data.planningItems||{});
setNotes(data.notes||{});
setDeadlines(data.deadlines||{});
setClients(data.clients||[]);
setTimeTracking(data.timeTracking||{});
saveLocalData(data.tasks||{},data.customItems||{},data.planningItems||{},data.notes||{},data.deadlines||{},data.clients||[],data.timeTracking||{});
setToast({type:'success',message:'‚úì Herladen voltooid'});
}
}catch(error){
setToast({type:'error',message:'Herladen mislukt'});
}
};

// ADMIN LOGIN
const handleAdminLogin=()=>{
setIsAdmin(true);
setShowAdminLogin(false);
setToast({type:'success',message:'‚úì Admin mode!'});
console.log('üîì ADMIN MODE');
};

// EXPORT DATA
const exportData=()=>{
const exportObj={
tasks,
customItems,
planningItems,
clients,
exportDate:new Date().toISOString(),
version:'1.0'
};
const dataStr=JSON.stringify(exportObj,null,2);
const dataBlob=new Blob([dataStr],{type:'application/json'});
const url=URL.createObjectURL(dataBlob);
const link=document.createElement('a');
link.href=url;
const date=new Date();
const filename=`seo-roadmap-backup-${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}-${String(date.getHours()).padStart(2,'0')}${String(date.getMinutes()).padStart(2,'0')}.json`;
link.download=filename;
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
URL.revokeObjectURL(url);
setToast({type:'success',message:'‚úì Data ge√´xporteerd!'});
};

// CLIENT FUNCTIONS
const addClient=()=>{
if(!isAdmin)return;
if(!newClient.name){setToast({type:'error',message:'Voer naam in'});return;}
const client={id:Date.now(),...newClient,createdAt:new Date().toISOString()};
const updatedClients=[...clients,client];
setClients(updatedClients);
saveData({tasks,customItems,planningItems,clients:updatedClients});
setShowModal(false);
setNewClient({name:'',website:'',seRanking:'',city:'',status:'schema',projectManager:'none',budget:0});
setToast({type:'success',message:'‚úì Klant toegevoegd'});
};

const editClient=()=>{
if(!isAdmin)return;
if(!editingClient||!editingClient.name){setToast({type:'error',message:'Voer naam in'});return;}
const updatedClients=clients.map(c=>c.id===editingClient.id?{...c,...editingClient}:c);
setClients(updatedClients);
saveData({tasks,customItems,planningItems,clients:updatedClients});
setShowEditModal(false);
setEditingClient(null);
setToast({type:'success',message:'‚úì Klant bijgewerkt'});
};

const updateClientStatus=(clientId,newStatus)=>{
if(!isAdmin)return;
const updatedClients=clients.map(c=>c.id===clientId?{...c,status:newStatus}:c);
setClients(updatedClients);
saveData({tasks,customItems,planningItems,clients:updatedClients});
setToast({type:'success',message:'‚úì Status bijgewerkt'});
};

const archiveClient=(clientId)=>{
if(!isAdmin)return;
const updatedClients=clients.map(c=>c.id===clientId?{...c,archived:true,archivedDate:new Date().toISOString()}:c);
setClients(updatedClients);
saveData({tasks,customItems,planningItems,notes,deadlines,clients:updatedClients});
setToast({type:'success',message:'‚úì Klant gearchiveerd'});
};

const restoreClient=(clientId)=>{
if(!isAdmin)return;
const updatedClients=clients.map(c=>c.id===clientId?{...c,archived:false,archivedDate:null}:c);
setClients(updatedClients);
saveData({tasks,customItems,planningItems,notes,deadlines,clients:updatedClients});
setToast({type:'success',message:'‚úì Klant hersteld'});
};

const deleteClient=(id)=>{
if(!isAdmin)return;
const updatedClients=clients.filter(c=>c.id!==id);
const newTasks={...tasks};
const newCustomItems={...customItems};
const newPlanningItems={...planningItems};
Object.keys(newTasks).forEach(key=>{if(key.startsWith(`${id}-`))delete newTasks[key];});
Object.keys(newCustomItems).forEach(key=>{if(key.startsWith(`${id}-`))delete newCustomItems[key];});
Object.keys(newPlanningItems).forEach(key=>{if(key.startsWith(`${id}-`))delete newPlanningItems[key];});
setTasks(newTasks);
setCustomItems(newCustomItems);
setPlanningItems(newPlanningItems);
saveData({tasks:newTasks,customItems:newCustomItems,planningItems:newPlanningItems,clients:updatedClients});
if(selectedClient===id){setSelectedClient(null);setActiveView('dashboard');}
setShowDeleteModal(false);
setClientToDelete(null);
setToast({type:'success',message:'‚úì Verwijderd'});
};

// DEADLINE FUNCTIONS
const setDeadline=(key,date)=>{
if(!isAdmin)return;
const newDeadlines={...deadlines,[key]:date};
setDeadlines(newDeadlines);
saveData({tasks,customItems,planningItems,notes,deadlines:newDeadlines,clients});
setShowDeadlineModal(false);
setToast({type:'success',message:'‚úì Deadline ingesteld'});
};

const removeDeadline=(key)=>{
if(!isAdmin)return;
const newDeadlines={...deadlines};
delete newDeadlines[key];
setDeadlines(newDeadlines);
saveData({tasks,customItems,planningItems,notes,deadlines:newDeadlines,clients});
setToast({type:'success',message:'‚úì Deadline verwijderd'});
};

const getDeadlineUrgency=(dateStr)=>{
if(!dateStr)return{color:'gray',label:'Geen deadline',urgent:false};
const deadline=new Date(dateStr);
const now=new Date();
now.setHours(0,0,0,0);
deadline.setHours(0,0,0,0);
const diffDays=Math.ceil((deadline-now)/(1000*60*60*24));
if(diffDays<0)return{color:'red',label:'Verlopen',urgent:true};
if(diffDays===0)return{color:'red',label:'Vandaag!',urgent:true};
if(diffDays===1)return{color:'red',label:'Morgen',urgent:true};
if(diffDays<=7)return{color:'orange',label:`Over ${diffDays} dagen`,urgent:false};
return{color:'green',label:`Over ${diffDays} dagen`,urgent:false};
};

const getAllUpcomingDeadlines=()=>{
const upcoming=[];
Object.keys(deadlines).forEach(key=>{
// Only include planning items (keys with "planning" in them)
if(!key.includes('planning'))return;
const urgency=getDeadlineUrgency(deadlines[key]);
if(urgency.urgent){
const parts=key.split('-');
const clientId=parts[0];
const monthKey=parts[2];
const itemId=parts[3];
const client=clients.find(c=>c.id===clientId);
if(client){
// Find the planning item text
const monthItems=planningItems[`${clientId}-${monthKey}`]||[];
const item=monthItems.find(i=>i.id===itemId);
const itemText=item?item.text:'Planning item';
upcoming.push({key,date:deadlines[key],urgency,clientName:client.name,itemText});
}
}
});
return upcoming.sort((a,b)=>new Date(a.date)-new Date(b.date));
};

// AGENDA FUNCTIONS
const getAllAgendaItems=()=>{
const agenda=[];

// Collect ALL planning items (from step 7 - Planning)
const planningStep=STEPS.find(s=>s.id===7);
if(planningStep&&planningStep.months){
clients.forEach(client=>{
if(client.archived)return;
planningStep.months.forEach(month=>{
const items=planningItems[`${client.id}-${month.key}`]||[];
items.forEach(item=>{
if(item.completed)return;
// Check if item has explicit deadline
const itemKey=`${client.id}-planning-${month.key}-${item.id}`;
const explicitDeadline=deadlines[itemKey];
agenda.push({
type:'planning',
key:itemKey,
clientId:client.id,
clientName:client.name,
text:item.text,
date:explicitDeadline||month.label,
completed:false,
monthKey:month.key,
itemId:item.id
});
});
});
});
}

// Collect content items with deadlines (step 4)
clients.forEach(client=>{
if(client.archived)return;
const items=customItems[`${client.id}-4`]||[];
items.forEach(item=>{
if(item.deadline&&!item.completed){
agenda.push({
type:'content',
key:`${client.id}-4-${item.id}`,
clientId:client.id,
clientName:client.name,
text:item.keyword||item.url||item.text||'Content item',
date:item.deadline,
completed:false,
stepId:4,
itemId:item.id
});
}
});
});

// Sort by date
agenda.sort((a,b)=>{
const parseDate=(d)=>{
if(d.includes('-'))return new Date(d);
const months={Januari:0,Februari:1,Maart:2,April:3,Mei:4,Juni:5,Juli:6,Augustus:7,September:8,Oktober:9,November:10,December:11};
const parts=d.split(' ');
const month=months[parts[0]]||0;
const year=parseInt(parts[1])||new Date().getFullYear();
return new Date(year,month,15);
};
return parseDate(a.date)-parseDate(b.date);
});

// Group by urgency
const now=new Date();
const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());
const endOfThisMonth=new Date(now.getFullYear(),now.getMonth()+1,0);

const grouped={overdue:[],thisWeek:[],thisMonth:[],later:[]};
agenda.forEach(item=>{
const parseDate=(d)=>{
if(d.includes('-'))return new Date(d);
const months={Januari:0,Februari:1,Maart:2,April:3,Mei:4,Juni:5,Juli:6,Augustus:7,September:8,Oktober:9,November:10,December:11};
const parts=d.split(' ');
const month=months[parts[0]]||0;
const year=parseInt(parts[1])||new Date().getFullYear();
return new Date(year,month,15);
};
const itemDate=parseDate(item.date);
const weekFromNow=new Date(today.getTime()+7*24*60*60*1000);
if(itemDate<today){
grouped.overdue.push(item);
}else if(itemDate<=weekFromNow){
grouped.thisWeek.push(item);
}else if(itemDate<=endOfThisMonth){
grouped.thisMonth.push(item);
}else{
grouped.later.push(item);
}
});

return grouped;
};

const toggleAgendaItem=(item)=>{
if(!isAdmin)return;
console.log('üîÑ Toggle agenda item:',item);
if(item.type==='planning'){
console.log('üìÖ Toggling planning item for client:',item.clientId);
togglePlanningItem(item.monthKey,item.itemId,item.clientId);
}else if(item.type==='content'){
console.log('‚úçÔ∏è Toggling content item for client:',item.clientId);
toggleCustomItem(item.stepId,item.itemId,item.clientId);
}
};

// TIME TRACKING FUNCTIONS
const getCurrentMonth=()=>{
const now=new Date();
const year=now.getFullYear();
const month=now.getMonth()+1;
return `${year}-${month.toString().padStart(2,'0')}`;
};

const getClientHours=(clientId)=>{
const monthKey=getCurrentMonth();
const key=`${clientId}-${monthKey}`;
return timeTracking[key]||0;
};

const addClientHours=(clientId,hours)=>{
if(!isAdmin)return;
const monthKey=getCurrentMonth();
const key=`${clientId}-${monthKey}`;
const currentHours=timeTracking[key]||0;
const newHours=currentHours+hours;
const newTimeTracking={...timeTracking,[key]:newHours};
setTimeTracking(newTimeTracking);
saveData({tasks,customItems,planningItems,notes,deadlines,clients,timeTracking:newTimeTracking});
setShowTimeModal(false);
setTimeModalClient(null);
setTimeModalHours('');
setToast({type:'success',message:`‚úì ${hours}u toegevoegd`});
console.log('‚úÖ Hours added:',clientId,hours,'Total:',newHours);
};

const openTimeModal=(client)=>{
if(!isAdmin)return;
setTimeModalClient(client);
setTimeModalHours('');
setShowTimeModal(true);
};

// RAPPORTAGE FUNCTIONS
const getRapportageStats=()=>{
const stats={
totalClients:clients.filter(c=>!c.archived).length,
totalTasks:0,
completedTasks:0,
totalContent:0,
completedContent:0,
totalPlanning:0,
completedPlanning:0,
totalNotes:Object.keys(notes).length,
totalDeadlines:Object.keys(deadlines).length,
stepProgress:{}
};

// Tasks per step
STEPS.forEach(step=>{
let stepTotal=0;
let stepCompleted=0;
if(step.type==='tasks'||step.type==='hybrid'){
step.sections?.forEach(section=>{
section.tasks.forEach(task=>{
clients.forEach(client=>{
if(client.archived)return;
stepTotal++;
const key=`${client.id}-${step.id}-${task.id}`;
if(tasks[key])stepCompleted++;
});
});
});
}
if(step.type==='custom'||step.type==='hybrid'){
clients.forEach(client=>{
if(client.archived)return;
const items=customItems[`${client.id}-${step.id}`]||[];
stepTotal+=items.length;
stepCompleted+=items.filter(i=>i.completed).length;
if(step.id===4){
stats.totalContent+=items.length;
stats.completedContent+=items.filter(i=>i.completed).length;
}
});
}
stats.totalTasks+=stepTotal;
stats.completedTasks+=stepCompleted;
stats.stepProgress[step.id]={
name:step.name,
total:stepTotal,
completed:stepCompleted,
percentage:stepTotal>0?Math.round((stepCompleted/stepTotal)*100):0
};
});

// Planning items
clients.forEach(client=>{
if(client.archived)return;
STEPS[6]?.months?.forEach(month=>{
const items=planningItems[`${client.id}-${month.key}`]||[];
stats.totalPlanning+=items.length;
stats.completedPlanning+=items.filter(i=>i.completed).length;
});
});

return stats;
};

const getTopPerformers=()=>{
return clients
.filter(c=>!c.archived)
.map(c=>({
id:c.id,
name:c.name,
progress:getClientProgress(c.id)
}))
.sort((a,b)=>b.progress-a.progress)
.slice(0,5);
};

// NOTE FUNCTIONS
const addNote=(clientId,text)=>{
if(!isAdmin||!text.trim())return;
const noteId=Date.now();
const note={id:noteId,clientId,text:text.trim(),author:'Admin',timestamp:new Date().toISOString()};
const newNotes={...notes,[`${clientId}-${noteId}`]:note};
setNotes(newNotes);
saveData({tasks,customItems,planningItems,notes:newNotes,clients});
setShowNoteModal(false);
setToast({type:'success',message:'‚úì Notitie toegevoegd'});
};

const getClientNotes=(clientId)=>{
return Object.values(notes).filter(n=>n.clientId===clientId).sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
};

const deleteNote=(noteKey)=>{
if(!isAdmin)return;
const newNotes={...notes};
delete newNotes[noteKey];
setNotes(newNotes);
saveData({tasks,customItems,planningItems,notes:newNotes,clients});
setToast({type:'success',message:'‚úì Notitie verwijderd'});
};

// PDF EXPORT FUNCTION
const exportToPDF=()=>{
const client=clients.find(c=>c.id===selectedClient);
if(!client)return;

const {jsPDF}=window.jspdf;
const doc=new jsPDF();
let y=20;

// Title - centered and uppercase
doc.setFontSize(18);
doc.setFont(undefined,'bold');
doc.text(`SEO ROADMAP - ${client.name.toUpperCase()}`,105,y,{align:'center'});
y+=5;
doc.setLineWidth(0.5);
doc.line(20,y,190,y);
y+=12;

// Client Info with better formatting
doc.setFontSize(11);
doc.setFont(undefined,'bold');
doc.text('CLIENT INFORMATIE',20,y);
y+=7;
doc.setFont(undefined,'normal');
doc.setFontSize(9);
if(client.website){
doc.text('Website:',20,y);
doc.setFont(undefined,'bold');
doc.text(client.website,45,y);
doc.setFont(undefined,'normal');
y+=5;
}
if(client.city){
doc.text('Locatie:',20,y);
doc.setFont(undefined,'bold');
doc.text(client.city,45,y);
doc.setFont(undefined,'normal');
y+=5;
}
const statusInfo=getStatusInfo(client.status||'schema');
doc.text('Status:',20,y);
doc.setFont(undefined,'bold');
doc.text(statusInfo.label,45,y);
doc.setFont(undefined,'normal');
y+=5;
const pmInfo=getPMInfo(client.projectManager||'none');
if(pmInfo.key!=='none'){
doc.text('Projectmanager:',20,y);
doc.setFont(undefined,'bold');
doc.text(pmInfo.label,45,y);
doc.setFont(undefined,'normal');
y+=5;
}
doc.text('Voortgang:',20,y);
const stats=getClientStats(client.id);
const progress=getClientProgress(client.id);
doc.setFont(undefined,'bold');
doc.text(`${stats.completed}/${stats.total} taken (${progress}%)`,45,y);
doc.setFont(undefined,'normal');
y+=10;

// Steps with gray headers
STEPS.forEach((step,index)=>{
if(y>255){doc.addPage();y=20;}
doc.setFillColor(240,240,240);
doc.rect(20,y-4,170,8,'F');
doc.setFontSize(11);
doc.setFont(undefined,'bold');
doc.text(`STAP ${index+1}: ${step.name.toUpperCase()}`,22,y+1);
y+=10;

if(step.type==='tasks'||step.type==='hybrid'){
step.sections?.forEach(section=>{
if(y>260){doc.addPage();y=20;}
doc.setFontSize(9);
doc.setFont(undefined,'bold');
doc.text(section.title,25,y);
y+=5;
section.tasks.forEach(task=>{
if(y>268){doc.addPage();y=20;}
const key=`${selectedClient}-${step.id}-${task.id}`;
const isChecked=!!tasks[key];
doc.setFontSize(8);
doc.setFont(undefined,'normal');
doc.text(isChecked?'[X]':'[ ]',30,y);
doc.text(task.title,37,y);
y+=4;
});
y+=2;
});
}

if(step.type==='custom'||step.type==='hybrid'){
const items=customItems[`${selectedClient}-${step.id}`]||[];
if(items.length>0){
if(y>260){doc.addPage();y=20;}
doc.setFontSize(9);
doc.setFont(undefined,'bold');
if(step.type==='hybrid'){
doc.text(step.customSection?.title||'Custom Items',25,y);
}
y+=5;
items.forEach(item=>{
if(y>268){doc.addPage();y=20;}
doc.setFontSize(8);
doc.setFont(undefined,'normal');
const checkbox=item.completed?'[X]':'[ ]';
const itemText=step.customFields?.map(f=>item[f.key]).filter(Boolean).join(' - ')||item.text;
doc.text(`${checkbox} ${itemText}`,30,y);
if(item.deadline){
doc.setTextColor(200,0,0);
doc.text(`(${item.deadline})`,120,y);
doc.setTextColor(0,0,0);
}
y+=4;
});
y+=2;
}
}
y+=3;
});

// Planning section
if(y>240){doc.addPage();y=20;}
doc.setFillColor(240,240,240);
doc.rect(20,y-4,170,8,'F');
doc.setFontSize(11);
doc.setFont(undefined,'bold');
doc.text('PLANNING',22,y+1);
y+=10;
STEPS[6].months.forEach(month=>{
const items=planningItems[`${selectedClient}-${month.key}`]||[];
if(items.length>0){
if(y>255){doc.addPage();y=20;}
doc.setFontSize(9);
doc.setFont(undefined,'bold');
doc.text(month.label,25,y);
y+=5;
items.forEach(item=>{
if(y>268){doc.addPage();y=20;}
doc.setFontSize(8);
doc.setFont(undefined,'normal');
const itemKey=`${selectedClient}-planning-${month.key}-${item.id}`;
const deadline=deadlines[itemKey];
let text=item.text;
if(deadline){
const dd=new Date(deadline).toLocaleDateString('nl-NL',{day:'numeric',month:'short'});
text=`${item.text} (${dd})`;
}
doc.text(`- ${text}`,30,y);
y+=4;
});
y+=2;
}
});

// Notes section
const clientNotes=getClientNotes(selectedClient);
if(clientNotes.length>0){
if(y>235){doc.addPage();y=20;}
y+=5;
doc.setFillColor(240,240,240);
doc.rect(20,y-4,170,8,'F');
doc.setFontSize(11);
doc.setFont(undefined,'bold');
doc.text('NOTITIES',22,y+1);
y+=10;
clientNotes.forEach(note=>{
if(y>255){doc.addPage();y=20;}
doc.setFontSize(8);
doc.setFont(undefined,'bold');
const nd=new Date(note.timestamp).toLocaleDateString('nl-NL',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'});
doc.text(`${nd} - ${note.author}`,25,y);
y+=4;
doc.setFont(undefined,'normal');
const lines=doc.splitTextToSize(note.text,160);
lines.forEach(line=>{
if(y>268){doc.addPage();y=20;}
doc.text(line,25,y);
y+=4;
});
y+=2;
});
}

// Footer
const pageCount=doc.internal.getNumberOfPages();
for(let i=1;i<=pageCount;i++){
doc.setPage(i);
doc.setFontSize(7);
doc.setFont(undefined,'normal');
doc.setTextColor(100,100,100);
doc.text(`Gegenereerd: ${new Date().toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'})}`,20,287);
doc.text(`Pagina ${i} van ${pageCount}`,170,287,{align:'right'});
doc.setTextColor(0,0,0);
}

const filename=`SEO-Roadmap-${client.name.replace(/[^a-z0-9]/gi,'-')}.pdf`;
doc.save(filename);
setToast({type:'success',message:'‚úì PDF gedownload'});
};

// TASK FUNCTIONS
const toggleTask=(stepId,taskId)=>{
if(!isAdmin)return;
const key=`${selectedClient}-${stepId}-${taskId}`;
const newTasks={...tasks,[key]:!tasks[key]};
setTasks(newTasks);
saveData({tasks:newTasks,customItems,planningItems,clients});
};

const addCustomItem=(stepId,text)=>{
if(!isAdmin||!text.trim())return;
const key=`${selectedClient}-${stepId}`;
const items=customItems[key]||[];
const newItem={id:Date.now(),text:text.trim(),completed:false};
const newCustomItems={...customItems,[key]:[...items,newItem]};
setCustomItems(newCustomItems);
saveData({tasks,customItems:newCustomItems,planningItems,clients});
};

const addCustomItemWithFields=(stepId,fieldData)=>{
if(!isAdmin)return;
const key=`${selectedClient}-${stepId}`;
const items=customItems[key]||[];
const newItem={id:Date.now(),...fieldData,completed:false};
const newCustomItems={...customItems,[key]:[...items,newItem]};
setCustomItems(newCustomItems);
saveData({tasks,customItems:newCustomItems,planningItems,notes,deadlines,clients});
};

const toggleCustomItem=(stepId,itemId,clientId=null)=>{
if(!isAdmin)return;
const targetClientId=clientId||selectedClient;
if(!targetClientId){
console.error('‚ùå No client ID for toggleCustomItem');
return;
}
const key=`${targetClientId}-${stepId}`;
const items=customItems[key]||[];
const newItems=items.map(item=>item.id===itemId?{...item,completed:!item.completed}:item);
const newCustomItems={...customItems,[key]:newItems};
setCustomItems(newCustomItems);
saveData({tasks,customItems:newCustomItems,planningItems,notes,deadlines,clients});
console.log('‚úÖ Custom item toggled:',key,itemId);
};

const deleteCustomItem=(stepId,itemId)=>{
if(!isAdmin)return;
const key=`${selectedClient}-${stepId}`;
const items=customItems[key]||[];
const newItems=items.filter(item=>item.id!==itemId);
const newCustomItems={...customItems,[key]:newItems};
setCustomItems(newCustomItems);
saveData({tasks,customItems:newCustomItems,planningItems,clients});
};

// PLANNING FUNCTIONS
const addPlanningItem=(monthKey,text)=>{
if(!isAdmin||!text.trim())return;
const key=`${selectedClient}-${monthKey}`;
const items=planningItems[key]||[];
const newItem={id:Date.now(),text:text.trim(),completed:false};
const newPlanningItems={...planningItems,[key]:[...items,newItem]};
setPlanningItems(newPlanningItems);
saveData({tasks,customItems,planningItems:newPlanningItems,clients});
};

const togglePlanningItem=(monthKey,itemId,clientId=null)=>{
if(!isAdmin)return;
const targetClientId=clientId||selectedClient;
if(!targetClientId){
console.error('‚ùå No client ID for togglePlanningItem');
return;
}
const key=`${targetClientId}-${monthKey}`;
const items=planningItems[key]||[];
const newItems=items.map(item=>item.id===itemId?{...item,completed:!item.completed}:item);
const newPlanningItems={...planningItems,[key]:newItems};
setPlanningItems(newPlanningItems);
saveData({tasks,customItems,planningItems:newPlanningItems,notes,deadlines,clients});
console.log('‚úÖ Planning item toggled:',key,itemId);
};

const deletePlanningItem=(monthKey,itemId)=>{
if(!isAdmin)return;
const key=`${selectedClient}-${monthKey}`;
const items=planningItems[key]||[];
const newItems=items.filter(item=>item.id!==itemId);
const newPlanningItems={...planningItems,[key]:newItems};
setPlanningItems(newPlanningItems);
saveData({tasks,customItems,planningItems:newPlanningItems,clients});
};

// HELPERS
const getClientProgress=(clientId)=>{
let total=0;
let completed=0;
STEPS.forEach(step=>{
if(step.type==='planning'||step.type==='custom'||step.type==='hybrid')return;
if(step.sections){
step.sections.forEach(section=>{
section.tasks.forEach(task=>{
total++;
const key=`${clientId}-${step.id}-${task.id}`;
if(tasks[key])completed++;
});
});
}
});
return total>0?Math.round((completed/total)*100):0;
};

const getClientStats=(clientId)=>{
let totalTasks=0;
let completedTasks=0;
let customCount=0;
STEPS.forEach(step=>{
if(step.type==='planning')return;
if(step.sections){
step.sections.forEach(section=>{
section.tasks.forEach(task=>{
totalTasks++;
const key=`${clientId}-${step.id}-${task.id}`;
if(tasks[key])completedTasks++;
});
});
}
const customKey=`${clientId}-${step.id}`;
const customList=customItems[customKey]||[];
customCount+=customList.length;
totalTasks+=customList.length;
customList.forEach(item=>{if(item.completed)completedTasks++;});
});
return{total:totalTasks,completed:completedTasks,custom:customCount};
};

const getStepStats=(clientId,stepId)=>{
const step=STEPS.find(s=>s.id===stepId);
if(!step||step.type==='planning')return{total:0,completed:0};
let totalTasks=0;
let completedTasks=0;
if(step.sections){
step.sections.forEach(section=>{
section.tasks.forEach(task=>{
totalTasks++;
const key=`${clientId}-${step.id}-${task.id}`;
if(tasks[key])completedTasks++;
});
});
}
const customKey=`${clientId}-${step.id}`;
const customList=customItems[customKey]||[];
totalTasks+=customList.length;
customList.forEach(item=>{if(item.completed)completedTasks++;});
return{total:totalTasks,completed:completedTasks};
};

const getStatusCounts=()=>{
const counts={};
STATUS_OPTIONS.forEach(opt=>counts[opt.key]=0);
clients.forEach(client=>{
const status=client.status||'schema';
counts[status]=(counts[status]||0)+1;
});
return counts;
};

const getFilteredClients=()=>{
let filtered=clients;
// Filter by archive status
if(showArchive){
filtered=filtered.filter(c=>c.archived===true);
}else{
filtered=filtered.filter(c=>!c.archived);
}
if(statusFilter!=='all'){
filtered=filtered.filter(c=>(c.status||'schema')===statusFilter);
}
if(pmFilter!=='all'){
filtered=filtered.filter(c=>(c.projectManager||'none')===pmFilter);
}
// Sorting
if(sortOrder==='name-asc'){
filtered=[...filtered].sort((a,b)=>a.name.localeCompare(b.name));
}else if(sortOrder==='name-desc'){
filtered=[...filtered].sort((a,b)=>b.name.localeCompare(a.name));
}else if(sortOrder==='progress-asc'){
filtered=[...filtered].sort((a,b)=>getClientProgress(a.id)-getClientProgress(b.id));
}else if(sortOrder==='progress-desc'){
filtered=[...filtered].sort((a,b)=>getClientProgress(b.id)-getClientProgress(a.id));
}else if(sortOrder==='hours-asc'){
filtered=[...filtered].sort((a,b)=>getClientHours(a.id)-getClientHours(b.id));
}else if(sortOrder==='hours-desc'){
filtered=[...filtered].sort((a,b)=>getClientHours(b.id)-getClientHours(a.id));
}else if(sortOrder==='budget-asc'){
filtered=[...filtered].sort((a,b)=>(a.budget||0)-(b.budget||0));
}else if(sortOrder==='budget-desc'){
filtered=[...filtered].sort((a,b)=>(b.budget||0)-(a.budget||0));
}else if(sortOrder==='remaining-asc'){
filtered=[...filtered].sort((a,b)=>{
const remainingA=(a.budget||0)-getClientHours(a.id);
const remainingB=(b.budget||0)-getClientHours(b.id);
return remainingA-remainingB;
});
}else if(sortOrder==='remaining-desc'){
filtered=[...filtered].sort((a,b)=>{
const remainingA=(a.budget||0)-getClientHours(a.id);
const remainingB=(b.budget||0)-getClientHours(b.id);
return remainingB-remainingA;
});
}
return filtered;
};

const getStatusInfo=(statusKey)=>{
return STATUS_OPTIONS.find(s=>s.key===statusKey)||STATUS_OPTIONS[3];
};

const getPMInfo=(pmKey)=>{
return PROJECT_MANAGERS.find(p=>p.key===pmKey)||PROJECT_MANAGERS[2];
};

const getClientPlanning=(clientId)=>{
const now=new Date();
const currentMonth=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
const nextMonthDate=new Date(now.getFullYear(),now.getMonth()+1,1);
const nextMonth=`${nextMonthDate.getFullYear()}-${String(nextMonthDate.getMonth()+1).padStart(2,'0')}`;
const currentKey=`${clientId}-${currentMonth}`;
const nextKey=`${clientId}-${nextMonth}`;
return{
current:{month:currentMonth,items:planningItems[currentKey]||[]},
next:{month:nextMonth,items:planningItems[nextKey]||[]}
};
};

const getMonthName=(monthKey)=>{
const months=['Jan','Feb','Mrt','Apr','Mei','Jun','Jul','Aug','Sep','Okt','Nov','Dec'];
const [year,month]=monthKey.split('-');
return `${months[parseInt(month)-1]} ${year}`;
};

// LOADING
if(loading){
return(<div className="loading-screen"><div className="spinner"></div><div className="loading-text">Laden...</div></div>);
}

// DASHBOARD
console.log('üîç View check - activeView:',activeView,'selectedClient:',selectedClient);
if(activeView==='dashboard'){
console.log('‚úÖ Rendering DASHBOARD view');
const statusCounts=getStatusCounts();
const filteredClients=getFilteredClients();

return(
<div className={`app ${!isAdmin?'viewer-mode':''}`}>
<aside className="sidebar">
<div className="logo"><div className="logo-text">THE FULLY BOOKERS</div><div className="logo-subtitle">SEO Roadmap</div></div>
<div className="sync-status">
<div className={`sync-dot sync-${syncStatus}`}/>
<span className="sync-text">
{syncStatus==='connected'&&'‚úì Verbonden'}
{syncStatus==='connecting'&&'‚ö†Ô∏è Verbinden...'}
{syncStatus==='error'&&'‚ùå Fout'}
</span>
{syncStatus==='connected'&&<button className="reload-btn" onClick={reloadFromFirebase}>üîÑ</button>}
</div>
<div className="mode-indicator">
<div className={`mode-badge ${isAdmin?'admin':'viewer'}`}>
{isAdmin?'üîì Admin':'üëÅÔ∏è Viewer'}
</div>
<button className="dark-toggle" onClick={toggleDarkMode}>{darkMode?'‚òÄÔ∏è':'üåô'}</button>
</div>
{isAdmin&&(
<div className="save-status">
<div className={`save-status-dot ${saveStatus}`}/>
<span>
{saveStatus==='saving'&&'Opslaan...'}
{saveStatus==='success'&&'Opgeslagen'}
{saveStatus==='error'&&'Fout'}
</span>
</div>
)}
<nav>
<div className={`nav-item ${activeView==='dashboard'?'active':''}`} onClick={()=>setActiveView('dashboard')} style={{cursor:'pointer'}}>
<span className="nav-icon">üìä</span>
<span className="nav-text">Dashboard</span>
<span className="nav-count">{clients.filter(c=>!c.archived).length}</span>
</div>
{isAdmin&&(
<div className={`nav-item ${activeView==='agenda'?'active':''}`} onClick={()=>setActiveView('agenda')} style={{cursor:'pointer'}}>
<span className="nav-icon">üìÖ</span>
<span className="nav-text">Agenda</span>
<span className="nav-count">{(()=>{
const ag=getAllAgendaItems();
return ag.overdue.length+ag.thisWeek.length+ag.thisMonth.length+ag.later.length;
})()}</span>
</div>
)}
{isAdmin&&(
<div className={`nav-item ${activeView==='rapportage'?'active':''}`} onClick={()=>setActiveView('rapportage')} style={{cursor:'pointer'}}>
<span className="nav-icon">üìà</span>
<span className="nav-text">Rapportage</span>
</div>
)}
</nav>
{isAdmin&&(
<button className="export-btn" onClick={exportData}>
üíæ Export Data
</button>
)}
</aside>
<main className="main">
<header className="header">
<h1 className="title">{showArchive?'Archief':'Klanten Dashboard'}</h1>
<p className="subtitle">{showArchive?'Gearchiveerde projecten':'Overzicht van alle SEO projecten'}</p>
</header>

<div style={{display:'flex',gap:'12px',marginBottom:'24px'}}>
<button onClick={()=>setShowArchive(false)} style={{flex:1,padding:'12px 24px',background:!showArchive?'var(--blue)':'white',color:!showArchive?'white':'var(--text)',border:'1px solid var(--border)',borderRadius:'8px',fontSize:'14px',fontWeight:'600',cursor:'pointer',transition:'all 0.2s'}}>
üìä Actieve Projecten ({clients.filter(c=>!c.archived).length})
</button>
<button onClick={()=>setShowArchive(true)} style={{flex:1,padding:'12px 24px',background:showArchive?'var(--blue)':'white',color:showArchive?'white':'var(--text)',border:'1px solid var(--border)',borderRadius:'8px',fontSize:'14px',fontWeight:'600',cursor:'pointer',transition:'all 0.2s'}}>
üì¶ Archief ({clients.filter(c=>c.archived).length})
</button>
</div>

{!showArchive&&(()=>{
const upcoming=getAllUpcomingDeadlines();
if(upcoming.length===0)return null;
return(
<div style={{background:'#fef3c7',border:'1px solid #fbbf24',borderRadius:'8px',padding:'16px',marginBottom:'24px'}}>
<div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'12px',fontWeight:'600',fontSize:'14px',color:'#92400e'}}>
<span>‚ö†Ô∏è</span>
<span>Urgente Deadlines ({upcoming.length})</span>
</div>
{upcoming.slice(0,5).map(item=>(
<div key={item.key} style={{background:'white',border:'1px solid #fbbf24',borderRadius:'6px',padding:'10px',marginBottom:'8px',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
<div>
<div style={{fontWeight:'600',fontSize:'13px',color:'#333'}}>{item.clientName}</div>
<div style={{fontSize:'12px',color:'#666',marginTop:'2px'}}>{item.itemText}</div>
<div style={{fontSize:'12px',color:'#666',marginTop:'2px'}}>
üìÖ {new Date(item.date).toLocaleDateString('nl-NL',{day:'numeric',month:'short'})} - {item.urgency.label}
</div>
</div>
<div style={{fontSize:'20px'}}>{item.urgency.color==='red'?'üî¥':'üü°'}</div>
</div>
))}
{upcoming.length>5&&(
<div style={{fontSize:'12px',color:'#92400e',fontStyle:'italic',marginTop:'8px'}}>
+ {upcoming.length-5} meer urgente deadline(s)
</div>
)}
</div>
);
})()}

{!showArchive&&(
<>
<div className="status-overview">
{STATUS_OPTIONS.map(status=>(
<div key={status.key} className={`status-card ${status.key} ${statusFilter===status.key?'active':''}`} onClick={()=>setStatusFilter(statusFilter===status.key?'all':status.key)}>
<div className="status-icon">{status.icon}</div>
<div className="status-count">{statusCounts[status.key]||0}</div>
<div className="status-label">{status.label}</div>
</div>
))}
</div>

<div style={{display:'flex',gap:'24px',alignItems:'center',marginBottom:'24px'}}>
<div className="pm-overview" style={{flex:1}}>
<div className="pm-label">Projectmanagers:</div>
{PROJECT_MANAGERS.filter(pm=>pm.key!=='none').map(pm=>(
<div key={pm.key} className={`pm-filter-btn ${pmFilter===pm.key?'active':''}`} onClick={()=>setPmFilter(pmFilter===pm.key?'all':pm.key)}>
<span style={{marginRight:'4px'}}>{pm.icon}</span>
{pm.label}
{pmFilter===pm.key&&<span style={{marginLeft:'6px'}}>√ó</span>}
</div>
))}
{pmFilter!=='all'&&(
<div className="pm-filter-btn" onClick={()=>setPmFilter('all')} style={{opacity:0.7}}>
Alle PMs
</div>
)}
</div>

<div className="sort-section" style={{minWidth:'250px'}}>
<div className="sort-label">Sorteren:</div>
<select className="sort-dropdown" value={sortOrder} onChange={(e)=>setSortOrder(e.target.value)}>
<option value="default">Standaard (nieuwste eerst)</option>
<option value="name-asc">üìù A ‚Üí Z (Naam)</option>
<option value="name-desc">üìù Z ‚Üí A (Naam)</option>
<option value="progress-asc">üìä Laag ‚Üí Hoog (Voortgang)</option>
<option value="progress-desc">üìä Hoog ‚Üí Laag (Voortgang)</option>
<option value="hours-asc">‚è±Ô∏è Min ‚Üí Max (Uren deze maand)</option>
<option value="hours-desc">‚è±Ô∏è Max ‚Üí Min (Uren deze maand)</option>
<option value="budget-asc">üí∞ Laag ‚Üí Hoog (Budget)</option>
<option value="budget-desc">üí∞ Hoog ‚Üí Laag (Budget)</option>
<option value="remaining-asc">üîì Min ‚Üí Max (Resterend)</option>
<option value="remaining-desc">üîì Max ‚Üí Min (Resterend)</option>
</select>
</div>
</div>

{statusFilter!=='all'&&(
<div className="filter-bar">
<span className="filter-label">Filter:</span>
<button className="filter-btn active" onClick={()=>setStatusFilter('all')}>
{getStatusInfo(statusFilter).icon} {getStatusInfo(statusFilter).label}
<span style={{marginLeft:'4px'}}>√ó</span>
</button>
</div>
)}
</>
)}

<div className="dashboard-grid">
{filteredClients.map(client=>{
const stats=getClientStats(client.id);
const progress=getClientProgress(client.id);
const statusInfo=getStatusInfo(client.status||'schema');
const pmInfo=getPMInfo(client.projectManager||'none');
return(
<div key={client.id} className="client-card" onClick={()=>{console.log('üñ±Ô∏è Client card clicked:',client.name,'ID:',client.id);setSelectedClient(client.id);setActiveView('roadmap');console.log('‚úÖ State set - activeView: roadmap, selectedClient:',client.id);}}>
<div className={`client-status-badge ${statusInfo.key}`}>{statusInfo.icon}</div>
{isAdmin&&(<button className="edit-client-btn" onClick={(e)=>{e.stopPropagation();setEditingClient({...client});setShowEditModal(true);}}>‚úèÔ∏è</button>)}
<div className="client-header">
<div>
<h3 className="client-name">{client.name}</h3>
{pmInfo.key!=='none'&&(<div className="pm-badge" style={{background:pmInfo.color}}>{pmInfo.icon} {pmInfo.label}</div>)}
</div>
</div>
<div className="client-meta">
{client.city&&<span>üìç {client.city}</span>}
{client.website&&(<><br/><a href={client.website} target="_blank" className="client-link" onClick={(e)=>e.stopPropagation()}>üåê Website</a></>)}
{client.seRanking&&(<a href={client.seRanking} target="_blank" className="client-link" onClick={(e)=>e.stopPropagation()}>üìä SE Ranking</a>)}
{(()=>{const nc=getClientNotes(client.id).length;return nc>0?<span style={{marginLeft:'8px',fontSize:'13px',color:'#666'}}>üí¨ {nc}</span>:null;})()}
</div>
{client.budget>0&&(()=>{
const budget=client.budget;
const hours=getClientHours(client.id);
const percentage=budget>0?Math.round((hours/budget)*100):0;
const remaining=Math.max(0,budget-hours);
const barColor=percentage>=90?'#dc2626':percentage>=70?'#f59e0b':'#10b981';
const monthNames={1:'Januari',2:'Februari',3:'Maart',4:'April',5:'Mei',6:'Juni',7:'Juli',8:'Augustus',9:'September',10:'Oktober',11:'November',12:'December'};
const now=new Date();
const currentMonth=monthNames[now.getMonth()+1]+' '+now.getFullYear();
return(
<div style={{marginTop:'12px',padding:'12px',background:'var(--bg)',border:'1px solid var(--border)',borderRadius:'6px'}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'8px'}}>
<span style={{fontSize:'13px',fontWeight:'600',color:'var(--text)'}}>üí∞ Budget</span>
<span style={{fontSize:'13px',fontWeight:'700',color:'var(--blue)'}}>{budget} uren</span>
</div>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'6px'}}>
<span style={{fontSize:'12px',color:'var(--text-light)'}}>‚è±Ô∏è {currentMonth}</span>
<span style={{fontSize:'13px',fontWeight:'700',color:barColor}}>{hours}u ({percentage}%)</span>
</div>
<div style={{width:'100%',height:'6px',background:'var(--gray-bg)',borderRadius:'3px',overflow:'hidden',marginBottom:'8px'}}>
<div style={{width:`${Math.min(100,percentage)}%`,height:'100%',background:barColor,transition:'width 0.3s'}}/>
</div>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'8px'}}>
<span style={{fontSize:'12px',color:'var(--text-light)'}}>Resterend:</span>
<span style={{fontSize:'12px',fontWeight:'600',color:remaining<budget*0.3?'#dc2626':'var(--text)'}}>{remaining}u</span>
</div>
{isAdmin&&(
<button onClick={(e)=>{e.stopPropagation();openTimeModal(client);}} style={{width:'100%',padding:'6px',background:'var(--green-bg)',color:'var(--green)',border:'1px solid var(--green)',borderRadius:'4px',fontSize:'12px',fontWeight:'600',cursor:'pointer',transition:'all 0.2s'}} onMouseEnter={(e)=>{e.target.style.background='var(--green)';e.target.style.color='white';}} onMouseLeave={(e)=>{e.target.style.background='var(--green-bg)';e.target.style.color='var(--green)';}}>
+ Uren toevoegen
</button>
)}
</div>
);
})()}  
{isAdmin&&(
<button 
onClick={(e)=>{
console.log('üîµ Button clicked! Client object:',client);
console.log('üîµ Client ID:',client.id,'Type:',typeof client.id);
e.stopPropagation();
e.preventDefault();
if(!client.id){
console.error('‚ùå NO CLIENT ID!');
setToast({type:'error',message:'‚ùå Client heeft geen ID'});
return;
}
copyClientLink(client.id);
}} 
style={{
width:'100%',
marginTop:'12px',
padding:'10px',
background:'var(--blue-light)',
color:'var(--blue)',
border:'2px solid var(--blue)',
borderRadius:'6px',
fontSize:'13px',
fontWeight:'700',
cursor:'pointer',
display:'flex',
alignItems:'center',
justifyContent:'center',
gap:'8px',
transition:'all 0.2s'
}}
onMouseEnter={(e)=>{e.target.style.background='var(--blue)';e.target.style.color='white';}}
onMouseLeave={(e)=>{e.target.style.background='var(--blue-light)';e.target.style.color='var(--blue)';}}
>
<span style={{fontSize:'16px'}}>üîó</span>
<span>Copy Link voor Client</span>
</button>
)}
<div className="client-stats">
<div className="stat-box">
<div className="stat-number">{stats.total}</div>
<div className="stat-label">Taken</div>
</div>
<div className="stat-box">
<div className="stat-number">{stats.completed}</div>
<div className="stat-label">Afgerond</div>
</div>
<div className="stat-box">
<div className="stat-number">{stats.custom}</div>
<div className="stat-label">Custom</div>
</div>
</div>
<div className="progress-section">
<div className="progress-label">
<span>Voortgang</span>
<span className="progress-percentage">{progress}%</span>
</div>
<div className="progress-bar">
<div className="progress-fill" style={{width:`${progress}%`}}/>
</div>
</div>
{(()=>{
const planning=getClientPlanning(client.id);
const hasPlanning=planning.current.items.length>0||planning.next.items.length>0;
if(!hasPlanning)return null;
const isExpanded=expandedPlanning[client.id];
return(
<div className="planning-box">
<div className="planning-title" onClick={(e)=>{e.stopPropagation();setExpandedPlanning({...expandedPlanning,[client.id]:!isExpanded});}} style={{cursor:'pointer',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
<span>üìÖ Planning</span>
<span style={{fontSize:'14px',transition:'transform 0.2s',transform:isExpanded?'rotate(180deg)':'rotate(0deg)'}}>‚ñº</span>
</div>
{isExpanded&&(
<>
{planning.current.items.length>0&&(
<div style={{marginBottom:'8px',marginTop:'8px'}}>
<div style={{fontSize:'11px',fontWeight:'600',color:'var(--blue)',marginBottom:'4px'}}>{getMonthName(planning.current.month)}</div>
{planning.current.items.slice(0,3).map(item=>(
<div key={item.id} className="planning-item" style={{textDecoration:item.completed?'line-through':'none',opacity:item.completed?0.6:1}}>‚Ä¢ {item.text}</div>
))}
{planning.current.items.length>3&&<div className="planning-item" style={{fontStyle:'italic',color:'var(--text-light)'}}>+{planning.current.items.length-3} meer...</div>}
</div>
)}
{planning.next.items.length>0&&(
<div>
<div style={{fontSize:'11px',fontWeight:'600',color:'var(--blue)',marginBottom:'4px'}}>{getMonthName(planning.next.month)}</div>
{planning.next.items.slice(0,3).map(item=>(
<div key={item.id} className="planning-item" style={{textDecoration:item.completed?'line-through':'none',opacity:item.completed?0.6:1}}>‚Ä¢ {item.text}</div>
))}
{planning.next.items.length>3&&<div className="planning-item" style={{fontStyle:'italic',color:'var(--text-light)'}}>+{planning.next.items.length-3} meer...</div>}
</div>
)}
</>
)}
</div>
);
})()}
{showArchive?(
<div style={{marginTop:'12px',padding:'12px',background:'var(--bg)',borderRadius:'6px'}}>
<div style={{fontSize:'11px',color:'var(--text-light)',marginBottom:'8px'}}>
‚úÖ Gearchiveerd: {client.archivedDate?new Date(client.archivedDate).toLocaleDateString('nl-NL',{day:'numeric',month:'short',year:'numeric'}):''}
</div>
<div style={{display:'flex',gap:'8px'}}>
<button onClick={(e)=>{e.stopPropagation();setSelectedClient(client.id);setActiveView('roadmap');}} style={{flex:1,padding:'8px',background:'var(--blue)',color:'white',border:'none',borderRadius:'6px',fontSize:'12px',fontWeight:'600',cursor:'pointer'}}>
üëÅÔ∏è Bekijken
</button>
{isAdmin&&(
<button onClick={(e)=>{e.stopPropagation();restoreClient(client.id);}} style={{flex:1,padding:'8px',background:'var(--green)',color:'white',border:'none',borderRadius:'6px',fontSize:'12px',fontWeight:'600',cursor:'pointer'}}>
‚Ü©Ô∏è Herstellen
</button>
)}
</div>
</div>
):(
<>
{isAdmin&&<button className="delete-btn" onClick={(e)=>{e.stopPropagation();setClientToDelete(client.id);setShowDeleteModal(true);}}>üóëÔ∏è</button>}
</>
)}
</div>
);
})}
{isAdmin&&(
<div className="add-client-card" onClick={()=>setShowModal(true)}>
<div className="add-icon">+</div>
<div className="add-text">Nieuwe Klant</div>
</div>
)}
{!isAdmin&&(
<div className="add-client-card" style={{position:'relative',cursor:'not-allowed',opacity:0.6}}>
<div className="add-icon">üîí</div>
<div className="add-text">Admin Rechten</div>
<div className="viewer-overlay">
<div className="viewer-message">üëÅÔ∏è Viewer Mode</div>
</div>
</div>
)}
</div>

{filteredClients.length===0&&statusFilter!=='all'&&(
<div className="empty-state">
<div className="empty-icon">{getStatusInfo(statusFilter).icon}</div>
<div className="empty-text">Geen klanten met deze status</div>
</div>
)}

<div className="joke-footer">
<div className="joke-text">{SEO_JOKES[Math.floor(Math.random()*SEO_JOKES.length)]}</div>
</div>
</main>

{!isAdmin&&(
<button className="admin-login-btn" onClick={()=>setShowAdminLogin(true)}>
üîê Admin Login
</button>
)}

{showAdminLogin&&<AdminLoginModal onLogin={handleAdminLogin} onCancel={()=>setShowAdminLogin(false)}/>}

{isAdmin&&showModal&&(
<div className="modal-overlay" onClick={()=>setShowModal(false)}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">Nieuwe Klant Toevoegen</h2>
<div className="input-group">
<label className="input-label">Bedrijfsnaam *</label>
<input type="text" className="modal-input" value={newClient.name} onChange={(e)=>setNewClient({...newClient,name:e.target.value})} autoFocus/>
</div>
<div className="input-group">
<label className="input-label">Website</label>
<input type="text" className="modal-input" placeholder="https://..." value={newClient.website} onChange={(e)=>setNewClient({...newClient,website:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">SE Ranking Link</label>
<input type="text" className="modal-input" placeholder="https://..." value={newClient.seRanking} onChange={(e)=>setNewClient({...newClient,seRanking:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">Plaats</label>
<input type="text" className="modal-input" value={newClient.city} onChange={(e)=>setNewClient({...newClient,city:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">Budget (uren)</label>
<input type="number" className="modal-input" min="0" step="1" placeholder="0" value={newClient.budget||''} onChange={(e)=>setNewClient({...newClient,budget:parseInt(e.target.value)||0})}/>
</div>
<div className="input-group">
<label className="input-label">Status</label>
<div className="status-select">
{STATUS_OPTIONS.map(status=>(
<div key={status.key} className={`status-option ${newClient.status===status.key?'selected':''}`} onClick={()=>setNewClient({...newClient,status:status.key})}>
<span className="status-option-icon">{status.icon}</span>
<span className="status-option-text">{status.label}</span>
</div>
))}
</div>
</div>
<div className="input-group">
<label className="input-label">Projectmanager</label>
<div className="status-select">
{PROJECT_MANAGERS.map(pm=>(
<div key={pm.key} className={`status-option ${newClient.projectManager===pm.key?'selected':''}`} onClick={()=>setNewClient({...newClient,projectManager:pm.key})}>
<span className="status-option-icon">{pm.icon}</span>
<span className="status-option-text">{pm.label}</span>
</div>
))}
</div>
</div>
<div className="modal-buttons">
<button className="btn btn-primary" onClick={addClient}>Opslaan</button>
<button className="btn btn-secondary" onClick={()=>{setShowModal(false);setNewClient({name:'',website:'',seRanking:'',city:'',status:'schema',projectManager:'none',budget:0});}}>Annuleren</button>
</div>
</div>
</div>
)}

{isAdmin&&showEditModal&&editingClient&&(
<div className="modal-overlay" onClick={()=>setShowEditModal(false)}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">Klant Bewerken</h2>
<div className="input-group">
<label className="input-label">Bedrijfsnaam *</label>
<input type="text" className="modal-input" value={editingClient.name} onChange={(e)=>setEditingClient({...editingClient,name:e.target.value})} autoFocus/>
</div>
<div className="input-group">
<label className="input-label">Website</label>
<input type="text" className="modal-input" placeholder="https://..." value={editingClient.website||''} onChange={(e)=>setEditingClient({...editingClient,website:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">SE Ranking Link</label>
<input type="text" className="modal-input" placeholder="https://..." value={editingClient.seRanking||''} onChange={(e)=>setEditingClient({...editingClient,seRanking:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">Plaats</label>
<input type="text" className="modal-input" value={editingClient.city||''} onChange={(e)=>setEditingClient({...editingClient,city:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">Status</label>
<div className="status-select">
{STATUS_OPTIONS.map(status=>(
<div key={status.key} className={`status-option ${editingClient.status===status.key?'selected':''}`} onClick={()=>setEditingClient({...editingClient,status:status.key})}>
<span className="status-option-icon">{status.icon}</span>
<span className="status-option-text">{status.label}</span>
</div>
))}
</div>
</div>
<div className="input-group">
<label className="input-label">Projectmanager</label>
<div className="status-select">
{PROJECT_MANAGERS.map(pm=>(
<div key={pm.key} className={`status-option ${(editingClient.projectManager||'none')===pm.key?'selected':''}`} onClick={()=>setEditingClient({...editingClient,projectManager:pm.key})}>
<span className="status-option-icon">{pm.icon}</span>
<span className="status-option-text">{pm.label}</span>
</div>
))}
</div>
</div>
<div className="input-group">
<label className="input-label">Budget (uren)</label>
<input type="number" className="modal-input" min="0" step="1" placeholder="0" value={editingClient.budget||''} onChange={(e)=>setEditingClient({...editingClient,budget:parseInt(e.target.value)||0})}/>
</div>
<div className="modal-buttons">
<button className="btn btn-primary" onClick={editClient}>Opslaan</button>
<button className="btn btn-secondary" onClick={()=>{setShowEditModal(false);setEditingClient(null);}}>Annuleren</button>
</div>
</div>
</div>
)}

{toast&&<Toast message={toast.message} type={toast.type} onClose={()=>setToast(null)}/>}
</div>
);
}

// AGENDA VIEW
if(activeView==='agenda'){
const agendaItems=getAllAgendaItems();

return(
<div className={`app ${!isAdmin?'viewer-mode':''}`}>
<aside className="sidebar">
<div className="logo"><div className="logo-text">THE FULLY BOOKERS</div><div className="logo-subtitle">SEO Roadmap</div></div>
<div className="sync-status">
<div className={`sync-dot sync-${syncStatus}`}/>
<span className="sync-text">
{syncStatus==='connected'&&'‚úì Verbonden'}
{syncStatus==='connecting'&&'‚ö†Ô∏è Verbinden...'}
{syncStatus==='error'&&'‚ùå Fout'}
</span>
{syncStatus==='connected'&&<button className="reload-btn" onClick={reloadFromFirebase}>üîÑ</button>}
</div>
<div className="mode-indicator">
<div className={`mode-badge ${isAdmin?'admin':'viewer'}`}>
{isAdmin?'üîì Admin':'üëÅÔ∏è Viewer'}
</div>
<button className="dark-toggle" onClick={toggleDarkMode}>{darkMode?'‚òÄÔ∏è':'üåô'}</button>
</div>
{isAdmin&&(
<div className="save-status">
<div className={`save-status-dot ${saveStatus}`}/>
<span>
{saveStatus==='saving'&&'Opslaan...'}
{saveStatus==='success'&&'Opgeslagen'}
{saveStatus==='error'&&'Fout'}
</span>
</div>
)}
<nav>
<div className={`nav-item ${activeView==='dashboard'?'active':''}`} onClick={()=>setActiveView('dashboard')} style={{cursor:'pointer'}}>
<span className="nav-icon">üìä</span>
<span className="nav-text">Dashboard</span>
<span className="nav-count">{clients.filter(c=>!c.archived).length}</span>
</div>
{isAdmin&&(
<div className={`nav-item ${activeView==='agenda'?'active':''}`} onClick={()=>setActiveView('agenda')} style={{cursor:'pointer'}}>
<span className="nav-icon">üìÖ</span>
<span className="nav-text">Agenda</span>
<span className="nav-count">{agendaItems.overdue.length+agendaItems.thisWeek.length+agendaItems.later.length}</span>
</div>
)}
</nav>
{isAdmin&&(
<button className="export-btn" onClick={exportData}>
üíæ Export Data
</button>
)}
</aside>

<main className="main">
<header className="header">
<h1 className="title">üìÖ Agenda</h1>
<p className="subtitle">Alle taken met deadlines op volgorde</p>
</header>

{agendaItems.overdue.length===0&&agendaItems.thisWeek.length===0&&agendaItems.thisMonth.length===0&&agendaItems.later.length===0&&(
<div style={{textAlign:'center',padding:'64px 24px',color:'var(--text-light)'}}>
<div style={{fontSize:'48px',marginBottom:'16px'}}>‚úì</div>
<div style={{fontSize:'18px',fontWeight:'600',marginBottom:'8px'}}>Geen openstaande deadlines!</div>
<div style={{fontSize:'14px'}}>Alle taken met deadlines zijn voltooid</div>
</div>
)}

{agendaItems.overdue.length>0&&(
<div style={{marginBottom:'32px'}}>
<div style={{background:'#fef2f2',border:'1px solid #fecaca',borderRadius:'8px',padding:'12px 16px',marginBottom:'16px',display:'flex',alignItems:'center',gap:'12px'}}>
<span style={{fontSize:'20px'}}>üî¥</span>
<div style={{flex:1}}>
<div style={{fontWeight:'600',color:'#991b1b'}}>VERLOPEN / VANDAAG ({agendaItems.overdue.length})</div>
<div style={{fontSize:'12px',color:'#991b1b',marginTop:'2px'}}>Deze taken hebben prioriteit!</div>
</div>
</div>
{agendaItems.overdue.map(item=>(
<div key={item.key} className="task-card" style={{marginBottom:'12px',background:'#fef2f2',borderLeft:'4px solid #dc2626'}}>
<div className={`checkbox ${item.completed?'checked':''} clickable`} onClick={()=>toggleAgendaItem(item)}/>
<div className="task-content" style={{flex:1}}>
<div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'4px'}}>
<span style={{fontWeight:'600',color:'#111827'}}>{item.clientName}</span>
<span style={{padding:'2px 8px',background:'#dbeafe',color:'#1e40af',borderRadius:'4px',fontSize:'11px',fontWeight:'600'}}>{item.type==='planning'?'Planning':'Content'}</span>
</div>
<div className="task-title">{item.text}</div>
<div style={{fontSize:'12px',color:'#dc2626',marginTop:'4px',display:'flex',alignItems:'center',gap:'4px'}}>
<span>üìÖ</span>
<span>{typeof item.date==='string'&&item.date.includes('-')?new Date(item.date).toLocaleDateString('nl-NL',{day:'numeric',month:'short',year:'numeric'}):item.date}</span>
</div>
</div>
<button className="btn" style={{padding:'6px 12px',fontSize:'12px'}} onClick={(e)=>{e.stopPropagation();setSelectedClient(item.clientId);setActiveView('roadmap');}}>
‚Üí Open
</button>
</div>
))}
</div>
)}

{agendaItems.thisWeek.length>0&&(
<div style={{marginBottom:'32px'}}>
<div style={{background:'#fef9c3',border:'1px solid #fde047',borderRadius:'8px',padding:'12px 16px',marginBottom:'16px',display:'flex',alignItems:'center',gap:'12px'}}>
<span style={{fontSize:'20px'}}>üü°</span>
<div style={{flex:1}}>
<div style={{fontWeight:'600',color:'#854d0e'}}>DEZE WEEK ({agendaItems.thisWeek.length})</div>
<div style={{fontSize:'12px',color:'#854d0e',marginTop:'2px'}}>Binnenkort af te ronden</div>
</div>
</div>
{agendaItems.thisWeek.map(item=>(
<div key={item.key} className="task-card" style={{marginBottom:'12px',borderLeft:'4px solid #eab308'}}>
<div className={`checkbox ${item.completed?'checked':''} clickable`} onClick={()=>toggleAgendaItem(item)}/>
<div className="task-content" style={{flex:1}}>
<div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'4px'}}>
<span style={{fontWeight:'600',color:'#111827'}}>{item.clientName}</span>
<span style={{padding:'2px 8px',background:'#dbeafe',color:'#1e40af',borderRadius:'4px',fontSize:'11px',fontWeight:'600'}}>{item.type==='planning'?'Planning':'Content'}</span>
</div>
<div className="task-title">{item.text}</div>
<div style={{fontSize:'12px',color:'#854d0e',marginTop:'4px',display:'flex',alignItems:'center',gap:'4px'}}>
<span>üìÖ</span>
<span>{typeof item.date==='string'&&item.date.includes('-')?new Date(item.date).toLocaleDateString('nl-NL',{day:'numeric',month:'short',year:'numeric'}):item.date}</span>
</div>
</div>
<button className="btn" style={{padding:'6px 12px',fontSize:'12px'}} onClick={(e)=>{e.stopPropagation();setSelectedClient(item.clientId);setActiveView('roadmap');}}>
‚Üí Open
</button>
</div>
))}
</div>
)}

{agendaItems.thisMonth.length>0&&(
<div style={{marginBottom:'32px'}}>
<div style={{background:'#dbeafe',border:'1px solid #3b82f6',borderRadius:'8px',padding:'12px 16px',marginBottom:'16px',display:'flex',alignItems:'center',gap:'12px'}}>
<span style={{fontSize:'20px'}}>üîµ</span>
<div style={{flex:1}}>
<div style={{fontWeight:'600',color:'#1e40af'}}>DEZE MAAND ({agendaItems.thisMonth.length})</div>
<div style={{fontSize:'12px',color:'#1e40af',marginTop:'2px'}}>Deze maand afronden</div>
</div>
</div>
{agendaItems.thisMonth.map(item=>(
<div key={item.key} className="task-card" style={{marginBottom:'12px',borderLeft:'4px solid #3b82f6'}}>
<div className={`checkbox ${item.completed?'checked':''} clickable`} onClick={()=>toggleAgendaItem(item)}/>
<div className="task-content" style={{flex:1}}>
<div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'4px'}}>
<span style={{fontWeight:'600',color:'#111827'}}>{item.clientName}</span>
<span style={{padding:'2px 8px',background:'#dbeafe',color:'#1e40af',borderRadius:'4px',fontSize:'11px',fontWeight:'600'}}>{item.type==='planning'?'Planning':'Content'}</span>
</div>
<div className="task-title">{item.text}</div>
<div style={{fontSize:'12px',color:'#1e40af',marginTop:'4px',display:'flex',alignItems:'center',gap:'4px'}}>
<span>üìÖ</span>
<span>{typeof item.date==='string'&&item.date.includes('-')?new Date(item.date).toLocaleDateString('nl-NL',{day:'numeric',month:'short',year:'numeric'}):item.date}</span>
</div>
</div>
<button className="btn" style={{padding:'6px 12px',fontSize:'12px'}} onClick={(e)=>{e.stopPropagation();setSelectedClient(item.clientId);setActiveView('roadmap');}}>
‚Üí Open
</button>
</div>
))}
</div>
)}

{agendaItems.later.length>0&&(
<div style={{marginBottom:'32px'}}>
<div style={{background:'#f0fdf4',border:'1px solid #86efac',borderRadius:'8px',padding:'12px 16px',marginBottom:'16px',display:'flex',alignItems:'center',gap:'12px'}}>
<span style={{fontSize:'20px'}}>üü¢</span>
<div style={{flex:1}}>
<div style={{fontWeight:'600',color:'#166534'}}>VOLGENDE PERIODE ({agendaItems.later.length})</div>
<div style={{fontSize:'12px',color:'#166534',marginTop:'2px'}}>Geen haast, maar wel plannen</div>
</div>
</div>
{agendaItems.later.map(item=>(
<div key={item.key} className="task-card" style={{marginBottom:'12px',borderLeft:'4px solid #10b981'}}>
<div className={`checkbox ${item.completed?'checked':''} clickable`} onClick={()=>toggleAgendaItem(item)}/>
<div className="task-content" style={{flex:1}}>
<div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'4px'}}>
<span style={{fontWeight:'600',color:'#111827'}}>{item.clientName}</span>
<span style={{padding:'2px 8px',background:'#dbeafe',color:'#1e40af',borderRadius:'4px',fontSize:'11px',fontWeight:'600'}}>{item.type==='planning'?'Planning':'Content'}</span>
</div>
<div className="task-title">{item.text}</div>
<div style={{fontSize:'12px',color:'#166534',marginTop:'4px',display:'flex',alignItems:'center',gap:'4px'}}>
<span>üìÖ</span>
<span>{typeof item.date==='string'&&item.date.includes('-')?new Date(item.date).toLocaleDateString('nl-NL',{day:'numeric',month:'short',year:'numeric'}):item.date}</span>
</div>
</div>
<button className="btn" style={{padding:'6px 12px',fontSize:'12px'}} onClick={(e)=>{e.stopPropagation();setSelectedClient(item.clientId);setActiveView('roadmap');}}>
‚Üí Open
</button>
</div>
))}
</div>
)}

{toast&&<Toast message={toast.message} type={toast.type} onClose={()=>setToast(null)}/>}
</main>
</div>
);
}

// RAPPORTAGE VIEW
if(activeView==='rapportage'){
const stats=getRapportageStats();
const topPerformers=getTopPerformers();

return(
<div className={`app ${!isAdmin?'viewer-mode':''}`}>
<aside className="sidebar">
<div className="logo"><div className="logo-text">THE FULLY BOOKERS</div><div className="logo-subtitle">SEO Roadmap</div></div>
<div className="sync-status">
<div className={`sync-dot sync-${syncStatus}`}/>
<span className="sync-text">
{syncStatus==='connected'&&'‚úì Verbonden'}
{syncStatus==='connecting'&&'‚ö†Ô∏è Verbinden...'}
{syncStatus==='error'&&'‚ùå Fout'}
</span>
{syncStatus==='connected'&&<button className="reload-btn" onClick={reloadFromFirebase}>üîÑ</button>}
</div>
<div className="mode-indicator">
<div className={`mode-badge ${isAdmin?'admin':'viewer'}`}>
{isAdmin?'üîì Admin':'üëÅÔ∏è Viewer'}
</div>
<button className="dark-toggle" onClick={toggleDarkMode}>{darkMode?'‚òÄÔ∏è':'üåô'}</button>
</div>
{isAdmin&&(
<div className="save-status">
<div className={`save-status-dot ${saveStatus}`}/>
<span>
{saveStatus==='saving'&&'Opslaan...'}
{saveStatus==='success'&&'Opgeslagen'}
{saveStatus==='error'&&'Fout'}
</span>
</div>
)}
<nav>
<div className={`nav-item ${activeView==='dashboard'?'active':''}`} onClick={()=>setActiveView('dashboard')} style={{cursor:'pointer'}}>
<span className="nav-icon">üìä</span>
<span className="nav-text">Dashboard</span>
<span className="nav-count">{clients.filter(c=>!c.archived).length}</span>
</div>
{isAdmin&&(
<div className={`nav-item ${activeView==='agenda'?'active':''}`} onClick={()=>setActiveView('agenda')} style={{cursor:'pointer'}}>
<span className="nav-icon">üìÖ</span>
<span className="nav-text">Agenda</span>
<span className="nav-count">{(()=>{const ag=getAllAgendaItems();return ag.overdue.length+ag.thisWeek.length+ag.thisMonth.length+ag.later.length;})()}</span>
</div>
)}
{isAdmin&&(
<div className={`nav-item ${activeView==='rapportage'?'active':''}`} onClick={()=>setActiveView('rapportage')} style={{cursor:'pointer'}}>
<span className="nav-icon">üìà</span>
<span className="nav-text">Rapportage</span>
</div>
)}
</nav>
{isAdmin&&(<button className="export-btn" onClick={exportData}>üíæ Export Data</button>)}
</aside>

<main className="main">
<header className="header">
<h1 className="title">üìà Rapportage</h1>
<p className="subtitle">Overzicht van alle statistieken en voortgang</p>
</header>

<div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(200px,1fr))',gap:'16px',marginBottom:'32px'}}>
<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'20px'}}>
<div style={{fontSize:'32px',fontWeight:'700',color:'var(--blue)',marginBottom:'4px'}}>{stats.totalClients}</div>
<div style={{fontSize:'14px',color:'var(--text-light)'}}>Actieve Clients</div>
</div>
<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'20px'}}>
<div style={{fontSize:'32px',fontWeight:'700',color:'var(--green)',marginBottom:'4px'}}>{stats.completedTasks}</div>
<div style={{fontSize:'14px',color:'var(--text-light)'}}>Taken Voltooid</div>
</div>
<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'20px'}}>
<div style={{fontSize:'32px',fontWeight:'700',color:'var(--orange)',marginBottom:'4px'}}>{stats.completedContent}</div>
<div style={{fontSize:'14px',color:'var(--text-light)'}}>Content Items</div>
</div>
<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'20px'}}>
<div style={{fontSize:'32px',fontWeight:'700',color:'var(--red)',marginBottom:'4px'}}>{stats.totalDeadlines}</div>
<div style={{fontSize:'14px',color:'var(--text-light)'}}>Actieve Deadlines</div>
</div>
</div>

<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'24px',marginBottom:'32px'}}>
<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'24px'}}>
<h2 style={{fontSize:'18px',fontWeight:'700',marginBottom:'16px',display:'flex',alignItems:'center',gap:'8px'}}>
<span>üèÜ</span><span>Top Performers</span>
</h2>
{topPerformers.map((client,idx)=>(
<div key={client.id} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'12px',background:idx===0?'var(--yellow-bg)':idx===1?'var(--blue-light)':idx===2?'var(--orange-bg)':'var(--bg)',borderRadius:'6px',marginBottom:'8px',cursor:'pointer'}} onClick={()=>{setSelectedClient(client.id);setActiveView('roadmap');}}>
<div style={{display:'flex',alignItems:'center',gap:'12px'}}>
<span style={{fontSize:'20px'}}>{idx===0?'ü•á':idx===1?'ü•à':idx===2?'ü•â':`${idx+1}.`}</span>
<span style={{fontWeight:'600'}}>{client.name}</span>
</div>
<span style={{fontWeight:'700',color:'var(--green)'}}>{client.progress}%</span>
</div>
))}
</div>

<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'24px'}}>
<h2 style={{fontSize:'18px',fontWeight:'700',marginBottom:'16px',display:'flex',alignItems:'center',gap:'8px'}}>
<span>üìä</span><span>Voortgang per Stap</span>
</h2>
{Object.values(stats.stepProgress).map(step=>(
<div key={step.name} style={{marginBottom:'16px'}}>
<div style={{display:'flex',justifyContent:'space-between',marginBottom:'4px'}}>
<span style={{fontSize:'13px',fontWeight:'600'}}>{step.name}</span>
<span style={{fontSize:'13px',fontWeight:'700',color:step.percentage>75?'var(--green)':step.percentage>50?'var(--orange)':'var(--red)'}}>{step.percentage}%</span>
</div>
<div style={{height:'8px',background:'var(--bg)',borderRadius:'4px',overflow:'hidden'}}>
<div style={{height:'100%',width:`${step.percentage}%`,background:step.percentage>75?'var(--green)':step.percentage>50?'var(--orange)':'var(--red)',transition:'width 0.3s'}}/>
</div>
<div style={{fontSize:'11px',color:'var(--text-light)',marginTop:'2px'}}>{step.completed} / {step.total} voltooid</div>
</div>
))}
</div>
</div>

{toast&&<Toast message={toast.message} type={toast.type} onClose={()=>setToast(null)}/>}
</main>
</div>
);
}

// ROADMAP VIEW
console.log('üîç Roadmap check - activeView:',activeView,'selectedClient:',selectedClient);
if(activeView==='roadmap'||selectedClient){
console.log('‚úÖ Rendering ROADMAP view for client:',selectedClient);
const currentClient=clients.find(c=>c.id===selectedClient);
if(!currentClient){
// Fallback to dashboard if client not found
setActiveView('dashboard');
setSelectedClient(null);
return null;
}

const currentStep=activeStep==='overview'?null:STEPS.find(s=>s.id===activeStep);
const stats=getClientStats(selectedClient);
const progress=getClientProgress(selectedClient);
const statusInfo=getStatusInfo(currentClient.status||'schema');

return(
<div className={`app ${!isAdmin?'viewer-mode':''}`}>
<aside className="sidebar">
<div className="logo"><div className="logo-text">THE FULLY BOOKERS</div><div className="logo-subtitle">SEO Roadmap</div></div>
<div className="sync-status">
<div className={`sync-dot sync-${syncStatus}`}/>
<span className="sync-text">
{syncStatus==='connected'&&'‚úì Verbonden'}
{syncStatus==='connecting'&&'‚ö†Ô∏è Verbinden...'}
{syncStatus==='error'&&'‚ùå Fout'}
</span>
{syncStatus==='connected'&&<button className="reload-btn" onClick={reloadFromFirebase}>üîÑ</button>}
</div>
<div className="mode-indicator">
<div className={`mode-badge ${isAdmin?'admin':'viewer'}`}>
{isAdmin?'üîì Admin':'üëÅÔ∏è Viewer'}
</div>
<button className="dark-toggle" onClick={toggleDarkMode}>{darkMode?'‚òÄÔ∏è':'üåô'}</button>
</div>
{isAdmin&&(
<div className="save-status">
<div className={`save-status-dot ${saveStatus}`}/>
<span>
{saveStatus==='saving'&&'Opslaan...'}
{saveStatus==='success'&&'Opgeslagen'}
{saveStatus==='error'&&'Fout'}
</span>
</div>
)}
<nav>
<div className="nav-item" onClick={()=>setActiveView('dashboard')}>
<span className="nav-icon">üìä</span>
<span className="nav-text">Dashboard</span>
</div>
<div className={`nav-item ${activeStep==='overview'?'active':''}`} onClick={()=>setActiveStep('overview')}>
<span className="nav-icon">üìã</span>
<span className="nav-text">Overzicht</span>
</div>
{STEPS.map(step=>(
<div key={step.id} className={`nav-item ${activeStep===step.id?'active':''}`} onClick={()=>setActiveStep(step.id)}>
<span className="nav-icon">{step.icon}</span>
<span className="nav-text">{step.name}</span>
</div>
))}
</nav>
{isAdmin&&(
<button className="export-btn" onClick={exportData}>
üíæ Export Data
</button>
)}
</aside>
<main className="main">
<div className="current-client-banner">
<div className="banner-left">
<div className="banner-text">
Project: <span className="banner-client">{currentClient.name}</span>
</div>
<div className={`banner-status-display`} style={{borderLeft:`4px solid var(--${statusInfo.color})`}}>
<span className="banner-status-icon">{statusInfo.icon}</span>
<span>{statusInfo.label}</span>
</div>
<button className="dark-toggle" onClick={toggleDarkMode}>{darkMode?'‚òÄÔ∏è':'üåô'}</button>
</div>
{isAdmin&&(
<div className="banner-buttons">
<button className="banner-btn" onClick={()=>setShowNoteModal(true)}>üí¨ Notitie</button>
<button className="banner-btn" onClick={()=>setShowStatusModal(true)}>Status Wijzigen</button>
<button className="banner-btn" style={{background:'var(--red)',color:'white'}} onClick={exportToPDF}>üìÑ PDF Export</button>
{clients.find(c=>c.id===selectedClient)?.archived?(
<button className="banner-btn" style={{background:'var(--green)',color:'white'}} onClick={()=>{restoreClient(selectedClient);setActiveView('dashboard');}}>‚Ü©Ô∏è Herstellen</button>
):(
<button className="banner-btn" style={{background:'var(--orange)',color:'white'}} onClick={()=>{if(confirm('Client archiveren?'))archiveClient(selectedClient);}}>üì¶ Archiveren</button>
)}
<button className="banner-btn danger" onClick={()=>{setClientToDelete(selectedClient);setShowDeleteModal(true);}}>Verwijderen</button>
</div>
)}
</div>

<header className="header">
{activeStep==='overview'?(
<>
<h1 className="title">üìã Overzicht</h1>
<p className="subtitle">Complete status van {currentClient.name}</p>
</>
):(
currentStep&&(
<>
<h1 className="title">{currentStep.icon} {currentStep.name}</h1>
<p className="subtitle">Voortgang: {stats.completed} / {stats.total} taken ({progress}%)</p>
</>
)
)}
</header>

{activeStep==='overview'&&(
<div className="overview-content" style={{maxWidth:'900px'}}>

<div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(300px,1fr))',gap:'20px',marginBottom:'24px'}}>
<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'20px'}}>
<h3 style={{margin:'0 0 16px 0',fontSize:'16px',fontWeight:'600',color:'var(--text)',display:'flex',alignItems:'center',gap:'8px'}}>
<span>‚ÑπÔ∏è</span> Client Informatie
</h3>
<div style={{display:'flex',flexDirection:'column',gap:'12px'}}>
{currentClient.city&&(
<div style={{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'}}>
<span style={{color:'var(--text-light)'}}>üìç</span>
<span style={{color:'var(--text)'}}>{currentClient.city}</span>
</div>
)}
{currentClient.website&&(
<div style={{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'}}>
<span style={{color:'var(--text-light)'}}>üåê</span>
<a href={currentClient.website} target="_blank" rel="noopener noreferrer" style={{color:'var(--blue)',textDecoration:'none'}} onMouseEnter={(e)=>e.target.style.textDecoration='underline'} onMouseLeave={(e)=>e.target.style.textDecoration='none'}>
Website
</a>
</div>
)}
{currentClient.seRanking&&(
<div style={{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'}}>
<span style={{color:'var(--text-light)'}}>üìä</span>
<a href={currentClient.seRanking} target="_blank" rel="noopener noreferrer" style={{color:'var(--blue)',textDecoration:'none'}} onMouseEnter={(e)=>e.target.style.textDecoration='underline'} onMouseLeave={(e)=>e.target.style.textDecoration='none'}>
SE Ranking
</a>
</div>
)}
<div style={{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'}}>
<span style={{color:'var(--text-light)'}}>üë§</span>
<span style={{color:'var(--text)'}}>{getPMInfo(currentClient.projectManager||'none').label}</span>
</div>
</div>
</div>

<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'20px'}}>
<h3 style={{margin:'0 0 16px 0',fontSize:'16px',fontWeight:'600',color:'var(--text)',display:'flex',alignItems:'center',gap:'8px'}}>
<span>üìà</span> Project Status
</h3>
<div style={{display:'flex',flexDirection:'column',gap:'12px'}}>
<div style={{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'}}>
<span style={{color:'var(--text-light)'}}>Status:</span>
<div style={{display:'flex',alignItems:'center',gap:'6px',padding:'4px 12px',background:`var(--${statusInfo.color})`,color:'white',borderRadius:'12px',fontSize:'13px',fontWeight:'600'}}>
<span>{statusInfo.icon}</span>
<span>{statusInfo.label}</span>
</div>
</div>
<div style={{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'}}>
<span style={{color:'var(--text-light)'}}>Voortgang:</span>
<span style={{color:'var(--text)',fontWeight:'600'}}>{progress}%</span>
<span style={{color:'var(--text-light)'}}>({stats.completed}/{stats.total} taken)</span>
</div>
<div style={{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'}}>
<span style={{color:'var(--text-light)'}}>Aangemaakt:</span>
<span style={{color:'var(--text)'}}>{new Date(currentClient.id).toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'})}</span>
</div>
</div>
</div>
</div>

{currentClient.budget>0&&(
<div style={{background:'#f8fafc',border:'1px solid #e2e8f0',borderRadius:'8px',padding:'20px',marginBottom:'24px'}}>
<div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'16px'}}>
<h3 style={{margin:0,fontSize:'16px',fontWeight:'600',color:'#1e293b',display:'flex',alignItems:'center',gap:'8px'}}>
‚è±Ô∏è Tijd & Budget
</h3>
<div style={{fontSize:'14px',color:'#64748b'}}>
Budget: <span style={{fontWeight:'700',color:'#3b82f6'}}>{currentClient.budget} uren</span>
</div>
</div>
{(()=>{
const monthNames=['Januari','Februari','Maart','April','Mei','Juni','Juli','Augustus','September','Oktober','November','December'];
const now=new Date();
const currentYear=now.getFullYear();
const currentMonthIndex=now.getMonth();
const monthsToShow=[];
for(let i=0;i<6;i++){
const monthIndex=(currentMonthIndex-i+12)%12;
const year=currentMonthIndex-i<0?currentYear-1:currentYear;
const monthKey=`${year}-${(monthIndex+1).toString().padStart(2,'0')}`;
const monthLabel=`${monthNames[monthIndex]} ${year}`;
const hours=timeTracking[`${currentClient.id}-${monthKey}`]||0;
const isCurrent=i===0;
monthsToShow.push({monthKey,monthLabel,hours,isCurrent});
}
return monthsToShow.map(({monthKey,monthLabel,hours,isCurrent})=>{
const percentage=currentClient.budget>0?Math.round((hours/currentClient.budget)*100):0;
const barColor=percentage>=90?'#dc2626':percentage>=70?'#f59e0b':'#10b981';
return(
<div key={monthKey} style={{background:'white',border:isCurrent?'2px solid #3b82f6':'1px solid #e2e8f0',borderRadius:'6px',padding:'12px',marginBottom:'8px'}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'8px'}}>
<div style={{display:'flex',alignItems:'center',gap:'8px'}}>
<span style={{fontSize:'14px',fontWeight:'600',color:'#1e293b'}}>{monthLabel}</span>
{isCurrent&&<span style={{fontSize:'11px',background:'#3b82f6',color:'white',padding:'2px 8px',borderRadius:'12px'}}>Deze maand</span>}
</div>
<div style={{display:'flex',alignItems:'center',gap:'12px'}}>
<span style={{fontSize:'13px',color:'#64748b'}}>
<span style={{fontWeight:'700',color:barColor}}>{hours}u</span> / {currentClient.budget}u
</span>
{isAdmin&&(
<button onClick={(e)=>{e.stopPropagation();openTimeModal(currentClient);}} style={{padding:'4px 12px',background:'#10b981',color:'white',border:'none',borderRadius:'4px',fontSize:'12px',fontWeight:'600',cursor:'pointer',transition:'all 0.2s'}} onMouseEnter={(e)=>e.target.style.background='#059669'} onMouseLeave={(e)=>e.target.style.background='#10b981'}>
+ Toevoegen
</button>
)}
</div>
</div>
<div style={{display:'flex',alignItems:'center',gap:'12px'}}>
<div style={{flex:1,height:'6px',background:'#e2e8f0',borderRadius:'3px',overflow:'hidden'}}>
<div style={{width:`${Math.min(100,percentage)}%`,height:'100%',background:barColor,transition:'width 0.3s'}}/>
</div>
<span style={{fontSize:'12px',fontWeight:'600',color:barColor,minWidth:'40px',textAlign:'right'}}>{percentage}%</span>
</div>
</div>
);
});
})()}
</div>
)}

<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'20px',marginBottom:'24px'}}>
<h3 style={{margin:'0 0 16px 0',fontSize:'16px',fontWeight:'600',color:'var(--text)',display:'flex',alignItems:'center',gap:'8px'}}>
<span>üìã</span> Voortgang per Stap
</h3>
<div style={{display:'flex',flexDirection:'column',gap:'12px'}}>
{STEPS.map(step=>{
const stepStats=getStepStats(selectedClient,step.id);
const stepProgress=stepStats.total>0?Math.round((stepStats.completed/stepStats.total)*100):0;
const barColor=stepProgress===100?'#10b981':stepProgress>=70?'#3b82f6':stepProgress>=30?'#f59e0b':'#e2e8f0';
return(
<div key={step.id} style={{cursor:'pointer',padding:'12px',background:'var(--bg)',border:'1px solid var(--border)',borderRadius:'6px',transition:'all 0.2s'}} onClick={()=>setActiveStep(step.id)} onMouseEnter={(e)=>e.target.style.borderColor='var(--blue)'} onMouseLeave={(e)=>e.target.style.borderColor='var(--border)'}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'8px'}}>
<div style={{display:'flex',alignItems:'center',gap:'8px'}}>
<span style={{fontSize:'18px'}}>{step.icon}</span>
<span style={{fontSize:'14px',fontWeight:'600',color:'var(--text)'}}>{step.name}</span>
</div>
<div style={{display:'flex',alignItems:'center',gap:'8px'}}>
<span style={{fontSize:'13px',color:'var(--text-light)'}}>{stepStats.completed}/{stepStats.total}</span>
<span style={{fontSize:'14px',fontWeight:'700',color:stepProgress===100?'#10b981':'var(--text)'}}>{stepProgress}%</span>
</div>
</div>
<div style={{width:'100%',height:'6px',background:'#e2e8f0',borderRadius:'3px',overflow:'hidden'}}>
<div style={{width:`${stepProgress}%`,height:'100%',background:barColor,transition:'width 0.3s'}}/>
</div>
</div>
);
})}
</div>
</div>

{(()=>{
const clientNotes=getClientNotes(selectedClient);
if(clientNotes.length===0)return null;
return(
<div style={{background:'var(--white)',border:'1px solid var(--border)',borderRadius:'8px',padding:'20px'}}>
<h3 style={{margin:'0 0 16px 0',fontSize:'16px',fontWeight:'600',color:'var(--text)',display:'flex',alignItems:'center',gap:'8px'}}>
<span>üí¨</span> Recente Notities ({clientNotes.length})
</h3>
{clientNotes.slice(0,5).map(note=>(
<div key={note.id} style={{background:'var(--bg)',border:'1px solid var(--border)',borderRadius:'6px',padding:'12px',marginBottom:'8px',position:'relative'}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'start'}}>
<div style={{fontSize:'11px',color:'var(--text-light)',marginBottom:'6px'}}>
{new Date(note.timestamp).toLocaleString('nl-NL',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'})} - {note.author}
</div>
{isAdmin&&(
<button onClick={(e)=>{e.stopPropagation();if(confirm('Notitie verwijderen?'))deleteNote(`${selectedClient}-${note.id}`);}} style={{background:'none',border:'none',cursor:'pointer',padding:'4px',fontSize:'16px',lineHeight:'1',opacity:'0.6',transition:'opacity 0.2s'}} onMouseEnter={(e)=>e.target.style.opacity='1'} onMouseLeave={(e)=>e.target.style.opacity='0.6'}>
üóëÔ∏è
</button>
)}
</div>
<div style={{fontSize:'13px',color:'var(--text)',lineHeight:'1.5'}}>{note.text}</div>
</div>
))}
{clientNotes.length>5&&(
<div style={{fontSize:'12px',color:'var(--text-light)',fontStyle:'italic',marginTop:'8px'}}>
+ {clientNotes.length-5} meer notitie(s)
</div>
)}
</div>
);
})()}

</div>
)}

{activeStep!=='overview'&&(()=>{
const clientNotes=getClientNotes(selectedClient);
if(clientNotes.length===0)return null;
return(
<div className="notes-section" style={{background:'#f8f9fa',border:'1px solid #e1e4e8',borderRadius:'8px',padding:'16px',marginBottom:'24px'}}>
<div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'12px',fontWeight:'600',fontSize:'14px',color:'#444'}}>
<span>üí¨</span>
<span>Notities ({clientNotes.length})</span>
</div>
{clientNotes.slice(0,3).map(note=>(
<div key={note.id} style={{background:'white',border:'1px solid #e1e4e8',borderRadius:'6px',padding:'12px',marginBottom:'8px',position:'relative'}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'start'}}>
<div style={{fontSize:'11px',color:'#666',marginBottom:'6px'}}>
{new Date(note.timestamp).toLocaleString('nl-NL',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'})} - {note.author}
</div>
{isAdmin&&(
<button onClick={(e)=>{e.stopPropagation();if(confirm('Notitie verwijderen?'))deleteNote(`${selectedClient}-${note.id}`);}} style={{background:'none',border:'none',cursor:'pointer',padding:'4px',fontSize:'16px',lineHeight:'1',opacity:'0.6',transition:'opacity 0.2s'}} onMouseEnter={(e)=>e.target.style.opacity='1'} onMouseLeave={(e)=>e.target.style.opacity='0.6'}>
üóëÔ∏è
</button>
)}
</div>
<div style={{fontSize:'13px',color:'#333',lineHeight:'1.5'}}>{note.text}</div>
</div>
))}
{clientNotes.length>3&&(
<div style={{fontSize:'12px',color:'#666',fontStyle:'italic',marginTop:'8px'}}>
+ {clientNotes.length-3} meer notitie(s)
</div>
)}
</div>
);
})()}

{currentStep&&currentStep.type==='planning'?(
<>
{clients.find(c=>c.id===selectedClient)?.budget>0&&(
<div style={{background:'#f8fafc',border:'1px solid #e2e8f0',borderRadius:'8px',padding:'20px',marginBottom:'24px'}}>
<div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'16px'}}>
<h3 style={{margin:0,fontSize:'16px',fontWeight:'600',color:'#1e293b',display:'flex',alignItems:'center',gap:'8px'}}>
‚è±Ô∏è Tijd Tracking
</h3>
<div style={{fontSize:'14px',color:'#64748b'}}>
Budget: <span style={{fontWeight:'700',color:'#3b82f6'}}>{clients.find(c=>c.id===selectedClient)?.budget} uren</span>
</div>
</div>
{(()=>{
const client=clients.find(c=>c.id===selectedClient);
if(!client)return null;
const monthNames=['Januari','Februari','Maart','April','Mei','Juni','Juli','Augustus','September','Oktober','November','December'];
const now=new Date();
const currentYear=now.getFullYear();
const currentMonthIndex=now.getMonth();
const monthsToShow=[];
for(let i=0;i<6;i++){
const monthIndex=(currentMonthIndex-i+12)%12;
const year=currentMonthIndex-i<0?currentYear-1:currentYear;
const monthKey=`${year}-${(monthIndex+1).toString().padStart(2,'0')}`;
const monthLabel=`${monthNames[monthIndex]} ${year}`;
const hours=timeTracking[`${client.id}-${monthKey}`]||0;
const isCurrent=i===0;
monthsToShow.push({monthKey,monthLabel,hours,isCurrent});
}
return monthsToShow.map(({monthKey,monthLabel,hours,isCurrent})=>{
const percentage=client.budget>0?Math.round((hours/client.budget)*100):0;
const barColor=percentage>=90?'#dc2626':percentage>=70?'#f59e0b':'#10b981';
return(
<div key={monthKey} style={{background:'white',border:isCurrent?'2px solid #3b82f6':'1px solid #e2e8f0',borderRadius:'6px',padding:'12px',marginBottom:'8px'}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'8px'}}>
<div style={{display:'flex',alignItems:'center',gap:'8px'}}>
<span style={{fontSize:'14px',fontWeight:'600',color:'#1e293b'}}>{monthLabel}</span>
{isCurrent&&<span style={{fontSize:'11px',background:'#3b82f6',color:'white',padding:'2px 8px',borderRadius:'12px'}}>Deze maand</span>}
</div>
<div style={{display:'flex',alignItems:'center',gap:'12px'}}>
<span style={{fontSize:'13px',color:'#64748b'}}>
<span style={{fontWeight:'700',color:barColor}}>{hours}u</span> / {client.budget}u
</span>
{isAdmin&&(
<button onClick={(e)=>{e.stopPropagation();openTimeModal(client);}} style={{padding:'4px 12px',background:'#10b981',color:'white',border:'none',borderRadius:'4px',fontSize:'12px',fontWeight:'600',cursor:'pointer',transition:'all 0.2s'}} onMouseEnter={(e)=>e.target.style.background='#059669'} onMouseLeave={(e)=>e.target.style.background='#10b981'}>
+ Toevoegen
</button>
)}
</div>
</div>
<div style={{display:'flex',alignItems:'center',gap:'12px'}}>
<div style={{flex:1,height:'6px',background:'#e2e8f0',borderRadius:'3px',overflow:'hidden'}}>
<div style={{width:`${Math.min(100,percentage)}%`,height:'100%',background:barColor,transition:'width 0.3s'}}/>
</div>
<span style={{fontSize:'12px',fontWeight:'600',color:barColor,minWidth:'40px',textAlign:'right'}}>{percentage}%</span>
</div>
</div>
);
});
})()}
</div>
)}
{currentStep.months.map(month=>(
<PlanningMonth
key={month.key}
month={month}
selectedClient={selectedClient}
planningItems={planningItems}
onAdd={addPlanningItem}
onToggle={togglePlanningItem}
onDelete={deletePlanningItem}
getCurrentMonth={getCurrentMonth}
isAdmin={isAdmin}
deadlines={deadlines}
onSetDeadline={setDeadline}
onShowDeadlineModal={(key,title,currentDeadline)=>{setDeadlineModalTask({key,title,currentDeadline});setShowDeadlineModal(true);}}
/>
))}
</>
):(
<>
{currentStep.sections&&currentStep.sections.map(section=>(
<div key={section.title} className="section">
<div className="section-header">{section.title}</div>
{section.tasks.map(task=>{
const key=`${selectedClient}-${currentStep.id}-${task.id}`;
const isChecked=!!tasks[key];
return(
<div key={task.id} className={`task-card ${isChecked?'completed':''} ${isAdmin?'clickable':''}`} onClick={()=>{if(isAdmin)toggleTask(currentStep.id,task.id);}}>
<div className={`checkbox ${isChecked?'checked':''} ${isAdmin?'clickable':''}`}/>
<div className="task-content">
<div className="task-title">{task.title}</div>
{task.desc&&<div className="task-desc">{task.desc}</div>}
</div>
</div>
);
})}
</div>
))}

{currentStep&&(currentStep.type==='custom'||currentStep.type==='hybrid')&&(
<div className="section">
<div className="section-header">
{currentStep.type==='hybrid'?currentStep.customSection.title:'Custom Items'}
{isAdmin&&<button className="add-item-btn" onClick={()=>{setItemModalStep(currentStep.id);setItemModalData({});setShowItemModal(true);}}>+ Toevoegen</button>}
</div>
{(customItems[`${selectedClient}-${currentStep.id}`]||[]).map(item=>(
<div key={item.id} className={`task-card ${item.completed?'completed':''} ${isAdmin?'clickable':''}`}>
<div className={`checkbox ${item.completed?'checked':''} ${isAdmin?'clickable':''}`} onClick={()=>{if(isAdmin)toggleCustomItem(currentStep.id,item.id);}}/>
<div className="task-content">
<div className="task-title">
{currentStep.customFields?.map(f=>item[f.key]).filter(Boolean).join(' - ')||item.text}
</div>
{item.deadline&&(
<div style={{fontSize:'12px',color:'#666',marginTop:'4px'}}>
üìÖ {item.deadline}
</div>
)}
</div>
{isAdmin&&<button className="delete-item-btn" onClick={()=>deleteCustomItem(currentStep.id,item.id)}>üóëÔ∏è</button>}
</div>
))}
</div>
)}
</>
)}
</main>

{!isAdmin&&(
<button className="admin-login-btn" onClick={()=>setShowAdminLogin(true)}>
üîê Admin Login
</button>
)}

{showAdminLogin&&<AdminLoginModal onLogin={handleAdminLogin} onCancel={()=>setShowAdminLogin(false)}/>}

{isAdmin&&showModal&&(
<div className="modal-overlay" onClick={()=>setShowModal(false)}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">Nieuwe Klant Toevoegen</h2>
<div className="input-group">
<label className="input-label">Bedrijfsnaam *</label>
<input type="text" className="modal-input" value={newClient.name} onChange={(e)=>setNewClient({...newClient,name:e.target.value})} autoFocus/>
</div>
<div className="input-group">
<label className="input-label">Website</label>
<input type="text" className="modal-input" placeholder="https://..." value={newClient.website} onChange={(e)=>setNewClient({...newClient,website:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">SE Ranking Link</label>
<input type="text" className="modal-input" placeholder="https://..." value={newClient.seRanking} onChange={(e)=>setNewClient({...newClient,seRanking:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">Plaats</label>
<input type="text" className="modal-input" value={newClient.city} onChange={(e)=>setNewClient({...newClient,city:e.target.value})}/>
</div>
<div className="input-group">
<label className="input-label">Budget (uren)</label>
<input type="number" className="modal-input" min="0" step="1" placeholder="0" value={newClient.budget||''} onChange={(e)=>setNewClient({...newClient,budget:parseInt(e.target.value)||0})}/>
</div>
<div className="input-group">
<label className="input-label">Status</label>
<div className="status-select">
{STATUS_OPTIONS.map(status=>(
<div key={status.key} className={`status-option ${newClient.status===status.key?'selected':''}`} onClick={()=>setNewClient({...newClient,status:status.key})}>
<span className="status-option-icon">{status.icon}</span>
<span className="status-option-text">{status.label}</span>
</div>
))}
</div>
</div>
<div className="input-group">
<label className="input-label">Projectmanager</label>
<div className="status-select">
{PROJECT_MANAGERS.map(pm=>(
<div key={pm.key} className={`status-option ${newClient.projectManager===pm.key?'selected':''}`} onClick={()=>setNewClient({...newClient,projectManager:pm.key})}>
<span className="status-option-icon">{pm.icon}</span>
<span className="status-option-text">{pm.label}</span>
</div>
))}
</div>
</div>
<div className="modal-buttons">
<button className="btn btn-primary" onClick={addClient}>Opslaan</button>
<button className="btn btn-secondary" onClick={()=>{setShowModal(false);setNewClient({name:'',website:'',seRanking:'',city:'',status:'schema',projectManager:'none',budget:0});}}>Annuleren</button>
</div>
</div>
</div>
)}

{isAdmin&&showStatusModal&&(
<div className="modal-overlay" onClick={()=>setShowStatusModal(false)}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">Status Wijzigen</h2>
<div className="status-select">
{STATUS_OPTIONS.map(status=>(
<div key={status.key} className={`status-option ${currentClient.status===status.key?'selected':''}`} onClick={()=>{updateClientStatus(selectedClient,status.key);setShowStatusModal(false);}}>
<span className="status-option-icon">{status.icon}</span>
<span className="status-option-text">{status.label}</span>
</div>
))}
</div>
<div className="modal-buttons">
<button className="btn btn-secondary" onClick={()=>setShowStatusModal(false)}>Annuleren</button>
</div>
</div>
</div>
)}

{isAdmin&&showDeleteModal&&(
<div className="modal-overlay" onClick={()=>setShowDeleteModal(false)}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">Klant Verwijderen?</h2>
<p style={{marginBottom:'24px',color:'var(--text-light)'}}>Dit verwijdert alle taken en planning. Kan niet ongedaan gemaakt worden.</p>
<div className="modal-buttons">
<button className="btn btn-danger" onClick={()=>deleteClient(clientToDelete)}>Verwijderen</button>
<button className="btn btn-secondary" onClick={()=>{setShowDeleteModal(false);setClientToDelete(null);}}>Annuleren</button>
</div>
</div>
</div>
)}

{isAdmin&&showItemModal&&(
<div className="modal-overlay" onClick={()=>setShowItemModal(false)}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">
{(()=>{
const step=STEPS.find(s=>s.id===itemModalStep);
return step?.type==='hybrid'?`${step.customSection.title} Toevoegen`:'Custom Item Toevoegen';
})()}
</h2>
{(()=>{
const step=STEPS.find(s=>s.id===itemModalStep);
if(step?.customFields){
return step.customFields.map((field,idx)=>(
<div key={field.key} className="input-group">
<label className="input-label">{field.label}</label>
{field.type==='select'?(
<select className="modal-input" value={itemModalData[field.key]||''} onChange={(e)=>setItemModalData({...itemModalData,[field.key]:e.target.value})} autoFocus={idx===0}>
<option value="">Selecteer...</option>
{field.options.map(opt=>(
<option key={opt} value={opt}>{opt}</option>
))}
</select>
):(
<input type={field.type} className="modal-input" value={itemModalData[field.key]||''} onChange={(e)=>setItemModalData({...itemModalData,[field.key]:e.target.value})} autoFocus={idx===0} onKeyPress={(e)=>{if(e.key==='Enter'){const stepObj=STEPS.find(s=>s.id===itemModalStep);const itemData={};stepObj?.customFields.forEach(f=>{itemData[f.key]=itemModalData[f.key]||'';});addCustomItemWithFields(itemModalStep,itemData);setShowItemModal(false);setItemModalData({});}}}/>
)}
</div>
));
}else{
return(
<div className="input-group">
<label className="input-label">Omschrijving</label>
<input type="text" className="modal-input" value={itemModalData.text||''} onChange={(e)=>setItemModalData({...itemModalData,text:e.target.value})} autoFocus onKeyPress={(e)=>{if(e.key==='Enter'){addCustomItem(itemModalStep,itemModalData.text||'');setShowItemModal(false);setItemModalData({});}}}/>
</div>
);
}
})()}
<div className="modal-buttons">
<button className="btn btn-primary" onClick={()=>{
const step=STEPS.find(s=>s.id===itemModalStep);
if(step?.customFields){
const itemData={};
step.customFields.forEach(f=>{itemData[f.key]=itemModalData[f.key]||'';});
addCustomItemWithFields(itemModalStep,itemData);
}else{
addCustomItem(itemModalStep,itemModalData.text||'');
}
setShowItemModal(false);
setItemModalData({});
}}>Toevoegen</button>
<button className="btn btn-secondary" onClick={()=>{setShowItemModal(false);setItemModalData({});}}>Annuleren</button>
</div>
</div>
</div>
)}

{isAdmin&&showNoteModal&&(
<div className="modal-overlay" onClick={()=>setShowNoteModal(false)}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">Notitie Toevoegen</h2>
<div className="input-group">
<label className="input-label">Notitie</label>
<textarea className="modal-input" style={{minHeight:'120px',resize:'vertical'}} value={itemModalData.noteText||''} onChange={(e)=>setItemModalData({...itemModalData,noteText:e.target.value})} autoFocus placeholder="Voeg een notitie toe..."/>
</div>
<div className="modal-buttons">
<button className="btn btn-primary" onClick={()=>{addNote(selectedClient,itemModalData.noteText||'');setItemModalData({});}}>Opslaan</button>
<button className="btn btn-secondary" onClick={()=>{setShowNoteModal(false);setItemModalData({});}}>Annuleren</button>
</div>
</div>
</div>
)}

{isAdmin&&showDeadlineModal&&deadlineModalTask&&(
<div className="modal-overlay" onClick={()=>setShowDeadlineModal(false)}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">Deadline Instellen</h2>
<p style={{fontSize:'14px',color:'#666',marginBottom:'16px'}}>{deadlineModalTask.title}</p>
<div className="input-group">
<label className="input-label">Deadline</label>
<input type="date" className="modal-input" value={itemModalData.deadlineDate||deadlineModalTask.currentDeadline||''} onChange={(e)=>setItemModalData({...itemModalData,deadlineDate:e.target.value})} autoFocus/>
</div>
<div className="modal-buttons">
<button className="btn btn-primary" onClick={()=>{setDeadline(deadlineModalTask.key,itemModalData.deadlineDate||deadlineModalTask.currentDeadline);setItemModalData({});}}>Opslaan</button>
{deadlineModalTask.currentDeadline&&(
<button className="btn" style={{background:'#ef4444',color:'white'}} onClick={()=>{removeDeadline(deadlineModalTask.key);setItemModalData({});setShowDeadlineModal(false);}}>Verwijderen</button>
)}
<button className="btn btn-secondary" onClick={()=>{setShowDeadlineModal(false);setItemModalData({});}}>Annuleren</button>
</div>
</div>
</div>
)}

{showTimeModal&&timeModalClient&&(
<div className="modal-overlay" onClick={()=>{setShowTimeModal(false);setTimeModalClient(null);setTimeModalHours('');}}>
<div className="modal" onClick={(e)=>e.stopPropagation()}>
<h2 className="modal-title">‚è±Ô∏è Uren Toevoegen</h2>
<p style={{fontSize:'14px',color:'var(--text-light)',marginBottom:'16px'}}>{timeModalClient.name}</p>
<div className="input-group">
<label className="input-label">Aantal uren</label>
<input type="number" className="modal-input" min="0" step="0.5" placeholder="2.5" value={timeModalHours} onChange={(e)=>setTimeModalHours(e.target.value)} autoFocus onKeyDown={(e)=>{if(e.key==='Enter'&&timeModalHours){const hours=parseFloat(timeModalHours);if(hours>0){addClientHours(timeModalClient.id,hours);}}}}/>
<div style={{fontSize:'12px',color:'var(--text-light)',marginTop:'4px'}}>Gebruik decimalen voor halve uren (bijv. 2.5)</div>
</div>
<div style={{padding:'12px',background:'var(--bg)',borderRadius:'6px',marginBottom:'16px',border:'1px solid var(--border)'}}>
<div style={{display:'flex',justifyContent:'space-between',marginBottom:'4px'}}>
<span style={{fontSize:'13px',color:'var(--text-light)'}}>Huidige stand:</span>
<span style={{fontSize:'13px',fontWeight:'600'}}>{getClientHours(timeModalClient.id)}u</span>
</div>
<div style={{display:'flex',justifyContent:'space-between'}}>
<span style={{fontSize:'13px',color:'var(--text-light)'}}>Budget:</span>
<span style={{fontSize:'13px',fontWeight:'600'}}>{timeModalClient.budget}u</span>
</div>
</div>
<div className="modal-buttons">
<button className="btn btn-primary" onClick={()=>{const hours=parseFloat(timeModalHours);if(hours>0){addClientHours(timeModalClient.id,hours);}else{setToast({type:'error',message:'Voer geldig aantal uren in'});}}}>Toevoegen</button>
<button className="btn btn-secondary" onClick={()=>{setShowTimeModal(false);setTimeModalClient(null);setTimeModalHours('');}}>Annuleren</button>
</div>
</div>
</div>
)}

{toast&&<Toast message={toast.message} type={toast.type} onClose={()=>setToast(null)}/>}
</div>
);
}

// Return null if no view matches (shouldn't happen)
return null;
}

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
